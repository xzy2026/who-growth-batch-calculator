<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7岁以下儿童生长标准批量计算器</title>
    <!-- Favicon (浏览器标签页小图标) -->
    <link rel="icon" type="image/jpeg" href="assets/logo.jpg">
    <link rel="shortcut icon" type="image/jpeg" href="assets/logo.jpg">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            font-size: 16px;
            background: #ffffff;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .container {
            max-width: 100%;
            margin: 0;
            background: white;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #366092 0%, #4a7ba7 100%);
            color: white;
            padding: 30px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .header-logo {
            height: 90px;
            width: auto;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            /* 移除滤镜，显示logo原始颜色 */
        }
        
        .header-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .header-content {
            flex: 1;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            background: #f5f5f5;
            padding: 10px;
            border-radius: 10px;
        }

        .mode-btn {
            padding: 10px 20px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: #366092;
            color: white;
            border-color: #366092;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .btn-primary {
            background: #366092;
            color: white;
        }

        .btn-primary:hover {
            background: #4a7ba7;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #34ce57;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #e4606d;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #ffcd39;
        }

        .btn-template {
            background: #6f42c1;
            color: white;
        }

        .btn-template:hover {
            background: #8560c9;
        }

        .table-container {
            overflow-x: auto;
            overflow-y: auto;
            max-height: calc(100vh - 250px);
            min-height: 450px;
            margin-bottom: 20px;
            position: relative;
        }

        /* 确保水平滚动条始终可见 */
        .table-container::-webkit-scrollbar {
            height: 12px;
        }

        .table-container::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .table-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 6px;
        }

        .table-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* 水平滚动条始终显示在底部 */
        .table-container {
            scrollbar-width: thin;
            scrollbar-color: #888 #f1f1f1;
        }

        table {
            width: 100%;
            min-width: 2000px; /* 确保表格宽度足够，触发水平滚动 */
            border-collapse: collapse;
            background: white;
            font-size: 14px;
        }

        th {
            background: #366092;
            color: white;
            padding: 10px 6px;
            text-align: center;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: normal;
            word-wrap: break-word;
            font-size: 13px;
            line-height: 1.4;
        }

        td {
            padding: 10px 8px;
            border: 1px solid #ddd;
            text-align: center;
            vertical-align: middle;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        tr:hover {
            background: #f0f0f0;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        select {
            width: 100%;
            padding: 10px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            min-width: 60px;
            min-height: 42px;
            box-sizing: border-box;
            line-height: 1.4;
        }
        
        input::placeholder {
            font-size: 13px;
            color: #999;
            white-space: normal;
            overflow: visible;
            line-height: 1.5;
        }
        
        select {
            min-width: 70px;
        }
        
        .weight-input, .height-input {
            min-width: 80px;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #366092;
        }

        .result-cell {
            background: #e8f4f8;
            font-weight: bold;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #366092;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .info-box h3 {
            margin-bottom: 10px;
            color: #366092;
        }

        .status-bar {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            font-size: 15px;
        }

        .footer {
            background: linear-gradient(135deg, #366092 0%, #4a7ba7 100%);
            color: white;
            padding: 20px 30px;
            text-align: center;
            font-size: 14px;
            line-height: 1.6;
        }

        .footer p {
            margin: 5px 0;
            opacity: 0.9;
        }

        .footer a {
            color: white;
            text-decoration: underline;
        }

        .footer a:hover {
            opacity: 0.8;
        }

        .footer-logo {
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .footer-logo img {
            height: 50px;
            width: auto;
            opacity: 0.95;
            filter: brightness(0) invert(1);
            transition: opacity 0.3s;
        }

        .footer-logo img:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="assets/logo.jpg" alt="Logo" class="header-logo" onerror="this.style.display='none'">
            <div class="header-content">
                <h1>享智云®7岁以下儿童生长标准批量计算器</h1>
                <p>支持批量输入和导出Excel表格（根据WS/T 423-2022标准）</p>
            </div>
        </div>
        
        <div class="content">
            <div class="info-box">
                <h3>使用说明</h3>
                <p>1. 选择计算模式（百分位数值或标准差数值）</p>
                <p>2. 点击"下载模板"按钮下载Excel数据模板，填写数据后使用"导入Excel"按钮导入（记得导入前将模版中的示例删除）</p>
                <p>3. 点击"导入Excel"按钮可从Excel文件导入数据（支持姓名、性别、出生日期、测查日期、体重、身高、头围等）</p>
                <p>4. 或点击"添加行"按钮手动添加儿童数据行</p>
                <p>5. 输入儿童信息（性别和出生日期为必填项）</p>
                <p>6. 点击"批量计算"按钮计算所有数据（导入Excel后会自动计算）</p>
                <p>7. 点击"导出Excel"按钮导出结果</p>
            </div>

            <div class="toolbar">
                <div class="mode-selector">
                    <button class="mode-btn active" onclick="setMode('percentile')">百分位数值</button>
                    <button class="mode-btn" onclick="setMode('std')">标准差数值</button>
                </div>
                <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display: none;" onchange="importExcel(event)">
                <button class="btn btn-info" onclick="document.getElementById('excelFileInput').click()">导入Excel</button>
                <button class="btn btn-template" onclick="downloadTemplate()">下载模板</button>
                <button class="btn btn-primary" onclick="addRow()">添加行</button>
                <button class="btn btn-success" onclick="calculateAll()">批量计算</button>
                <button class="btn btn-warning" onclick="exportExcel()">导出Excel</button>
                <button class="btn btn-danger" onclick="clearAll()">清空所有</button>
            </div>

            <div class="table-container">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th style="width: 50px;">序号</th>
                            <th style="width: 100px;">姓名</th>
                            <th style="width: 70px;">性别</th>
                            <th style="width: 110px;">出生日期</th>
                            <th style="width: 100px;">实足年龄</th>
                            <th style="width: 110px;">测查日期</th>
                            <th style="width: 100px;">体重(kg)</th>
                            <th style="width: 110px;">标准体重(kg)</th>
                            <th style="width: 90px;">评价值</th>
                            <th style="width: 95px;">评价结果</th>
                            <th style="width: 100px;">身高(cm)</th>
                            <th style="width: 110px;">标准身高(cm)</th>
                            <th style="width: 90px;">评价值</th>
                            <th style="width: 95px;">评价结果</th>
                            <th style="width: 70px;">BMI</th>
                            <th style="width: 85px;">评价结果</th>
                            <th style="width: 120px;">年龄别体重</th>
                            <th style="width: 95px;">评价结果</th>
                            <th style="width: 120px;">年龄别身高</th>
                            <th style="width: 95px;">评价结果</th>
                            <th style="width: 120px;">身高别体重</th>
                            <th style="width: 95px;">评价结果</th>
                            <th style="width: 120px;">年龄别BMI</th>
                            <th style="width: 95px;">评价结果</th>
                            <th style="width: 90px;">头围(cm)</th>
                            <th style="width: 120px;">年龄别头围</th>
                            <th style="width: 95px;">评价结果</th>
                            <th style="width: 60px;">操作</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>

            <div class="status-bar" id="statusBar">
                共 0 行数据
            </div>
        </div>

        <div class="footer">
            <p>本计算器基于《7岁以下儿童生长标准》（WS/T 423-2022）</p>
            <p>数据仅供参考，如有疑问请咨询专业医疗机构</p>
            <p>隐私与数据安全声明:所有数据仅在本地处理，不会上传至服务器</p>
            <p>享智云幼儿智能体侧</p>
            <p>&copy; 2026 儿童生长标准批量计算器 | 版本 1.0</p>
        </div>
    </div>

    <script>
        let currentMode = 'percentile';
        let rowCount = 0;

        // 数据表（完整数据，根据WS/T 423-2022标准）
        const ageWeightBoy = {
            0: {P3: 2.8, P10: 3.0, P25: 3.2, P50: 3.5, P75: 3.7, P90: 4.0, P97: 4.2},
            1: {P3: 3.7, P10: 3.9, P25: 4.2, P50: 4.6, P75: 4.9, P90: 5.2, P97: 5.6},
            2: {P3: 4.7, P10: 5.0, P25: 5.4, P50: 5.8, P75: 6.2, P90: 6.7, P97: 7.1},
            3: {P3: 5.5, P10: 5.9, P25: 6.3, P50: 6.8, P75: 7.3, P90: 7.8, P97: 8.3},
            4: {P3: 6.1, P10: 6.5, P25: 7.0, P50: 7.5, P75: 8.1, P90: 8.6, P97: 9.2},
            5: {P3: 6.6, P10: 7.0, P25: 7.5, P50: 8.0, P75: 8.6, P90: 9.2, P97: 9.8},
            6: {P3: 6.9, P10: 7.4, P25: 7.9, P50: 8.4, P75: 9.1, P90: 9.7, P97: 10.3},
            7: {P3: 7.2, P10: 7.7, P25: 8.2, P50: 8.8, P75: 9.5, P90: 10.1, P97: 10.8},
            8: {P3: 7.5, P10: 8.0, P25: 8.5, P50: 9.1, P75: 9.8, P90: 10.4, P97: 11.1},
            9: {P3: 7.7, P10: 8.2, P25: 8.7, P50: 9.4, P75: 10.1, P90: 10.8, P97: 11.5},
            10: {P3: 7.9, P10: 8.4, P25: 9.0, P50: 9.6, P75: 10.3, P90: 11.0, P97: 11.8},
            11: {P3: 8.1, P10: 8.6, P25: 9.2, P50: 9.8, P75: 10.6, P90: 11.3, P97: 12.0},
            12: {P3: 8.3, P10: 8.8, P25: 9.4, P50: 10.1, P75: 10.8, P90: 11.5, P97: 12.3},
            13: {P3: 8.4, P10: 9.0, P25: 9.6, P50: 10.3, P75: 11.0, P90: 11.7, P97: 12.5},
            14: {P3: 8.6, P10: 9.2, P25: 9.7, P50: 10.5, P75: 11.2, P90: 12.0, P97: 12.8},
            15: {P3: 8.8, P10: 9.3, P25: 9.9, P50: 10.7, P75: 11.4, P90: 12.2, P97: 13.0},
            16: {P3: 9.0, P10: 9.5, P25: 10.1, P50: 10.9, P75: 11.7, P90: 12.4, P97: 13.3},
            17: {P3: 9.1, P10: 9.7, P25: 10.3, P50: 11.1, P75: 11.9, P90: 12.7, P97: 13.5},
            18: {P3: 9.3, P10: 9.9, P25: 10.5, P50: 11.3, P75: 12.1, P90: 12.9, P97: 13.8},
            19: {P3: 9.5, P10: 10.1, P25: 10.7, P50: 11.5, P75: 12.3, P90: 13.2, P97: 14.0},
            20: {P3: 9.7, P10: 10.3, P25: 10.9, P50: 11.7, P75: 12.6, P90: 13.4, P97: 14.3},
            21: {P3: 9.8, P10: 10.5, P25: 11.1, P50: 11.9, P75: 12.8, P90: 13.7, P97: 14.6},
            22: {P3: 10.0, P10: 10.6, P25: 11.3, P50: 12.2, P75: 13.0, P90: 13.9, P97: 14.8},
            23: {P3: 10.2, P10: 10.8, P25: 11.5, P50: 12.4, P75: 13.3, P90: 14.2, P97: 15.1},
            24: {P3: 10.4, P10: 11.0, P25: 11.7, P50: 12.6, P75: 13.5, P90: 14.4, P97: 15.4},
            27: {P3: 10.8, P10: 11.5, P25: 12.2, P50: 13.1, P75: 14.1, P90: 15.1, P97: 16.1},
            30: {P3: 11.2, P10: 12.0, P25: 12.7, P50: 13.7, P75: 14.7, P90: 15.7, P97: 16.7},
            33: {P3: 11.6, P10: 12.4, P25: 13.2, P50: 14.2, P75: 15.2, P90: 16.3, P97: 17.4},
            36: {P3: 12.0, P10: 12.8, P25: 13.6, P50: 14.6, P75: 15.8, P90: 16.9, P97: 18.0},
            39: {P3: 12.4, P10: 13.2, P25: 14.1, P50: 15.2, P75: 16.3, P90: 17.5, P97: 18.7},
            42: {P3: 12.8, P10: 13.7, P25: 14.6, P50: 15.7, P75: 16.9, P90: 18.1, P97: 19.4},
            45: {P3: 13.2, P10: 14.1, P25: 15.1, P50: 16.2, P75: 17.5, P90: 18.7, P97: 20.1},
            48: {P3: 13.6, P10: 14.5, P25: 15.5, P50: 16.7, P75: 18.1, P90: 19.4, P97: 20.8},
            51: {P3: 14.0, P10: 15.0, P25: 16.0, P50: 17.3, P75: 18.7, P90: 20.1, P97: 21.6},
            54: {P3: 14.5, P10: 15.4, P25: 16.5, P50: 17.9, P75: 19.3, P90: 20.8, P97: 22.4},
            57: {P3: 14.9, P10: 15.9, P25: 17.1, P50: 18.4, P75: 20.0, P90: 21.6, P97: 23.3},
            60: {P3: 15.3, P10: 16.4, P25: 17.6, P50: 19.1, P75: 20.7, P90: 22.4, P97: 24.2},
            63: {P3: 15.8, P10: 16.9, P25: 18.1, P50: 19.7, P75: 21.4, P90: 23.2, P97: 25.1},
            66: {P3: 16.2, P10: 17.4, P25: 18.7, P50: 20.3, P75: 22.2, P90: 24.0, P97: 26.0},
            69: {P3: 16.6, P10: 17.9, P25: 19.3, P50: 21.0, P75: 22.9, P90: 24.8, P97: 27.0},
            72: {P3: 17.1, P10: 18.3, P25: 19.8, P50: 21.6, P75: 23.6, P90: 25.7, P97: 27.9},
            75: {P3: 17.5, P10: 18.8, P25: 20.3, P50: 22.2, P75: 24.3, P90: 26.5, P97: 28.9},
            78: {P3: 17.8, P10: 19.2, P25: 20.8, P50: 22.8, P75: 25.0, P90: 27.3, P97: 29.8},
            81: {P3: 18.2, P10: 19.7, P25: 21.3, P50: 23.4, P75: 25.7, P90: 28.0, P97: 30.6}
        };

        const ageWeightGirl = {
            0: {P3: 2.7, P10: 2.9, P25: 3.1, P50: 3.3, P75: 3.6, P90: 3.8, P97: 4.1},
            1: {P3: 3.5, P10: 3.7, P25: 4.0, P50: 4.3, P75: 4.6, P90: 4.9, P97: 5.3},
            2: {P3: 4.4, P10: 4.7, P25: 5.0, P50: 5.4, P75: 5.8, P90: 6.2, P97: 6.6},
            3: {P3: 5.1, P10: 5.4, P25: 5.8, P50: 6.2, P75: 6.7, P90: 7.2, P97: 7.6},
            4: {P3: 5.6, P10: 6.0, P25: 6.4, P50: 6.9, P75: 7.4, P90: 7.9, P97: 8.4},
            5: {P3: 6.0, P10: 6.4, P25: 6.9, P50: 7.4, P75: 7.9, P90: 8.5, P97: 9.1},
            6: {P3: 6.4, P10: 6.8, P25: 7.2, P50: 7.8, P75: 8.4, P90: 9.0, P97: 9.6},
            7: {P3: 6.7, P10: 7.1, P25: 7.6, P50: 8.1, P75: 8.8, P90: 9.4, P97: 10.0},
            8: {P3: 6.9, P10: 7.4, P25: 7.9, P50: 8.4, P75: 9.1, P90: 9.7, P97: 10.4},
            9: {P3: 7.2, P10: 7.6, P25: 8.1, P50: 8.7, P75: 9.4, P90: 10.0, P97: 10.8},
            10: {P3: 7.4, P10: 7.8, P25: 8.3, P50: 9.0, P75: 9.6, P90: 10.3, P97: 11.1},
            11: {P3: 7.6, P10: 8.0, P25: 8.6, P50: 9.2, P75: 9.9, P90: 10.6, P97: 11.4},
            12: {P3: 7.7, P10: 8.2, P25: 8.8, P50: 9.4, P75: 10.1, P90: 10.9, P97: 11.6},
            13: {P3: 7.9, P10: 8.4, P25: 9.0, P50: 9.6, P75: 10.4, P90: 11.1, P97: 11.9},
            14: {P3: 8.1, P10: 8.6, P25: 9.2, P50: 9.8, P75: 10.6, P90: 11.3, P97: 12.2},
            15: {P3: 8.3, P10: 8.8, P25: 9.3, P50: 10.0, P75: 10.8, P90: 11.6, P97: 12.4},
            16: {P3: 8.4, P10: 9.0, P25: 9.5, P50: 10.3, P75: 11.0, P90: 11.8, P97: 12.7},
            17: {P3: 8.6, P10: 9.1, P25: 9.7, P50: 10.5, P75: 11.3, P90: 12.1, P97: 12.9},
            18: {P3: 8.8, P10: 9.3, P25: 9.9, P50: 10.7, P75: 11.5, P90: 12.3, P97: 13.2},
            19: {P3: 9.0, P10: 9.5, P25: 10.1, P50: 10.9, P75: 11.7, P90: 12.6, P97: 13.5},
            20: {P3: 9.1, P10: 9.7, P25: 10.3, P50: 11.1, P75: 12.0, P90: 12.8, P97: 13.8},
            21: {P3: 9.3, P10: 9.9, P25: 10.5, P50: 11.3, P75: 12.2, P90: 13.1, P97: 14.0},
            22: {P3: 9.5, P10: 10.1, P25: 10.7, P50: 11.5, P75: 12.4, P90: 13.3, P97: 14.3},
            23: {P3: 9.7, P10: 10.3, P25: 10.9, P50: 11.7, P75: 12.6, P90: 13.6, P97: 14.6},
            24: {P3: 9.8, P10: 10.4, P25: 11.1, P50: 11.9, P75: 12.9, P90: 13.8, P97: 14.8},
            27: {P3: 10.3, P10: 10.9, P25: 11.6, P50: 12.5, P75: 13.5, P90: 14.4, P97: 15.5},
            30: {P3: 10.7, P10: 11.4, P25: 12.1, P50: 13.0, P75: 14.1, P90: 15.1, P97: 16.2},
            33: {P3: 11.1, P10: 11.8, P25: 12.6, P50: 13.6, P75: 14.6, P90: 15.7, P97: 16.9},
            36: {P3: 11.5, P10: 12.3, P25: 13.1, P50: 14.1, P75: 15.3, P90: 16.4, P97: 17.7},
            39: {P3: 12.0, P10: 12.7, P25: 13.6, P50: 14.7, P75: 15.9, P90: 17.1, P97: 18.4},
            42: {P3: 12.4, P10: 13.2, P25: 14.1, P50: 15.2, P75: 16.4, P90: 17.7, P97: 19.1},
            45: {P3: 12.8, P10: 13.6, P25: 14.5, P50: 15.7, P75: 17.0, P90: 18.3, P97: 19.8},
            48: {P3: 13.1, P10: 14.0, P25: 15.0, P50: 16.2, P75: 17.6, P90: 18.9, P97: 20.5},
            51: {P3: 13.5, P10: 14.4, P25: 15.4, P50: 16.7, P75: 18.1, P90: 19.6, P97: 21.1},
            54: {P3: 13.9, P10: 14.8, P25: 15.9, P50: 17.2, P75: 18.7, P90: 20.2, P97: 21.9},
            57: {P3: 14.3, P10: 15.3, P25: 16.4, P50: 17.8, P75: 19.3, P90: 20.9, P97: 22.6},
            60: {P3: 14.7, P10: 15.8, P25: 16.9, P50: 18.4, P75: 20.0, P90: 21.6, P97: 23.4},
            63: {P3: 15.1, P10: 16.2, P25: 17.5, P50: 19.0, P75: 20.7, P90: 22.4, P97: 24.3},
            66: {P3: 15.5, P10: 16.7, P25: 18.0, P50: 19.6, P75: 21.4, P90: 23.2, P97: 25.1},
            69: {P3: 15.9, P10: 17.1, P25: 18.5, P50: 20.2, P75: 22.0, P90: 23.9, P97: 26.0},
            72: {P3: 16.3, P10: 17.6, P25: 19.0, P50: 20.7, P75: 22.7, P90: 24.7, P97: 26.8},
            75: {P3: 16.7, P10: 18.0, P25: 19.5, P50: 21.3, P75: 23.3, P90: 25.4, P97: 27.6},
            78: {P3: 17.0, P10: 18.4, P25: 19.9, P50: 21.8, P75: 24.0, P90: 26.1, P97: 28.5},
            81: {P3: 17.4, P10: 18.8, P25: 20.4, P50: 22.4, P75: 24.6, P90: 26.8, P97: 29.3}
        };

        const ageHeightBoy = {
            0: {P3: 47.6, P10: 48.7, P25: 49.9, P50: 51.2, P75: 52.5, P90: 53.6, P97: 54.8},
            1: {P3: 51.3, P10: 52.5, P25: 53.8, P50: 55.1, P75: 56.5, P90: 57.7, P97: 59.0},
            2: {P3: 54.9, P10: 56.2, P25: 57.5, P50: 59.0, P75: 60.4, P90: 61.7, P97: 63.0},
            3: {P3: 58.0, P10: 59.4, P25: 60.7, P50: 62.2, P75: 63.7, P90: 65.1, P97: 66.4},
            4: {P3: 60.5, P10: 61.8, P25: 63.1, P50: 64.6, P75: 66.1, P90: 67.4, P97: 68.7},
            5: {P3: 62.7, P10: 64.0, P25: 65.3, P50: 66.8, P75: 68.3, P90: 69.6, P97: 70.9},
            6: {P3: 64.2, P10: 65.7, P25: 67.1, P50: 68.7, P75: 70.3, P90: 71.8, P97: 73.2},
            7: {P3: 65.7, P10: 67.2, P25: 68.6, P50: 70.2, P75: 71.8, P90: 73.3, P97: 74.7},
            8: {P3: 67.1, P10: 68.6, P25: 70.0, P50: 71.6, P75: 73.2, P90: 74.7, P97: 76.1},
            9: {P3: 68.4, P10: 69.9, P25: 71.3, P50: 73.0, P75: 74.6, P90: 76.1, P97: 77.5},
            10: {P3: 69.6, P10: 71.1, P25: 72.6, P50: 74.3, P75: 75.9, P90: 77.4, P97: 78.8},
            11: {P3: 70.7, P10: 72.3, P25: 73.8, P50: 75.5, P75: 77.2, P90: 78.7, P97: 80.1},
            12: {P3: 71.7, P10: 73.3, P25: 74.9, P50: 76.7, P75: 78.5, P90: 80.1, P97: 81.6},
            13: {P3: 72.6, P10: 74.2, P25: 75.8, P50: 77.6, P75: 79.4, P90: 81.0, P97: 82.5},
            14: {P3: 73.5, P10: 75.1, P25: 76.7, P50: 78.5, P75: 80.3, P90: 81.9, P97: 83.4},
            15: {P3: 74.3, P10: 75.9, P25: 77.5, P50: 79.3, P75: 81.2, P90: 82.8, P97: 84.3},
            16: {P3: 75.1, P10: 76.7, P25: 78.3, P50: 80.1, P75: 82.0, P90: 83.6, P97: 85.2},
            17: {P3: 75.8, P10: 77.5, P25: 79.2, P50: 81.0, P75: 82.9, P90: 84.6, P97: 86.3},
            18: {P3: 76.5, P10: 78.2, P25: 80.0, P50: 81.8, P75: 83.7, P90: 85.4, P97: 87.2},
            19: {P3: 77.2, P10: 79.0, P25: 80.7, P50: 82.6, P75: 84.5, P90: 86.2, P97: 88.0},
            20: {P3: 77.8, P10: 79.6, P25: 81.4, P50: 83.3, P75: 85.2, P90: 87.0, P97: 88.8},
            21: {P3: 78.4, P10: 80.2, P25: 82.0, P50: 84.0, P75: 85.9, P90: 87.7, P97: 89.6},
            22: {P3: 79.0, P10: 80.8, P25: 82.6, P50: 84.6, P75: 86.6, P90: 88.4, P97: 90.3},
            23: {P3: 79.6, P10: 81.4, P25: 83.2, P50: 85.2, P75: 87.2, P90: 89.1, P97: 91.0},
            24: {P3: 82.4, P10: 84.2, P25: 86.1, P50: 88.2, P75: 90.3, P90: 92.2, P97: 94.0},
            27: {P3: 84.8, P10: 86.7, P25: 88.6, P50: 90.8, P75: 93.0, P90: 94.9, P97: 96.8},
            30: {P3: 87.0, P10: 88.9, P25: 91.0, P50: 93.2, P75: 95.4, P90: 97.4, P97: 99.4},
            33: {P3: 89.0, P10: 91.0, P25: 93.1, P50: 95.4, P75: 97.7, P90: 99.8, P97: 101.8},
            36: {P3: 90.9, P10: 93.0, P25: 95.1, P50: 97.5, P75: 99.9, P90: 102.0, P97: 104.1},
            39: {P3: 92.7, P10: 94.8, P25: 97.0, P50: 99.5, P75: 101.9, P90: 104.1, P97: 106.2},
            42: {P3: 94.4, P10: 96.6, P25: 98.8, P50: 101.3, P75: 103.8, P90: 106.1, P97: 108.3},
            45: {P3: 96.0, P10: 98.3, P25: 100.6, P50: 103.1, P75: 105.7, P90: 108.0, P97: 110.2},
            48: {P3: 97.6, P10: 99.9, P25: 102.3, P50: 104.9, P75: 107.5, P90: 109.8, P97: 112.2},
            51: {P3: 99.2, P10: 101.6, P25: 104.0, P50: 106.6, P75: 109.3, P90: 111.7, P97: 114.1},
            54: {P3: 100.8, P10: 103.2, P25: 105.7, P50: 108.4, P75: 111.1, P90: 113.6, P97: 116.0},
            57: {P3: 102.4, P10: 104.9, P25: 107.4, P50: 110.2, P75: 113.0, P90: 115.5, P97: 117.9},
            60: {P3: 104.1, P10: 106.6, P25: 109.1, P50: 112.0, P75: 114.8, P90: 117.4, P97: 119.9},
            63: {P3: 105.7, P10: 108.2, P25: 110.9, P50: 113.7, P75: 116.6, P90: 119.2, P97: 121.8},
            66: {P3: 107.2, P10: 109.9, P25: 112.5, P50: 115.5, P75: 118.4, P90: 121.1, P97: 123.7},
            69: {P3: 108.8, P10: 111.4, P25: 114.1, P50: 117.1, P75: 120.2, P90: 122.9, P97: 125.5},
            72: {P3: 110.3, P10: 113.0, P25: 115.7, P50: 118.8, P75: 121.9, P90: 124.6, P97: 127.3},
            75: {P3: 111.7, P10: 114.5, P25: 117.3, P50: 120.4, P75: 123.5, P90: 126.3, P97: 129.1},
            78: {P3: 113.1, P10: 116.0, P25: 118.8, P50: 122.0, P75: 125.2, P90: 128.0, P97: 130.8},
            81: {P3: 114.5, P10: 117.4, P25: 120.3, P50: 123.5, P75: 126.7, P90: 129.6, P97: 132.5}
        };

        const ageHeightGirl = {
            0: {P3: 46.8, P10: 47.9, P25: 49.1, P50: 50.3, P75: 51.6, P90: 52.7, P97: 53.8},
            1: {P3: 50.4, P10: 51.6, P25: 52.8, P50: 54.1, P75: 55.4, P90: 56.6, P97: 57.8},
            2: {P3: 53.8, P10: 55.0, P25: 56.3, P50: 57.7, P75: 59.1, P90: 60.4, P97: 61.6},
            3: {P3: 56.7, P10: 58.0, P25: 59.3, P50: 60.8, P75: 62.2, P90: 63.5, P97: 64.8},
            4: {P3: 59.1, P10: 60.4, P25: 61.7, P50: 63.3, P75: 64.8, P90: 66.1, P97: 67.4},
            5: {P3: 61.0, P10: 62.4, P25: 63.8, P50: 65.3, P75: 66.9, P90: 68.2, P97: 69.6},
            6: {P3: 62.7, P10: 64.1, P25: 65.5, P50: 67.1, P75: 68.7, P90: 70.1, P97: 71.5},
            7: {P3: 64.2, P10: 65.6, P25: 67.1, P50: 68.7, P75: 70.3, P90: 71.7, P97: 73.1},
            8: {P3: 65.6, P10: 67.0, P25: 68.5, P50: 70.1, P75: 71.7, P90: 73.2, P97: 74.7},
            9: {P3: 66.8, P10: 68.3, P25: 69.8, P50: 71.5, P75: 73.1, P90: 74.6, P97: 76.1},
            10: {P3: 68.1, P10: 69.6, P25: 71.1, P50: 72.8, P75: 74.5, P90: 76.0, P97: 77.5},
            11: {P3: 69.2, P10: 70.8, P25: 72.3, P50: 74.0, P75: 75.7, P90: 77.3, P97: 78.8},
            12: {P3: 70.4, P10: 71.9, P25: 73.5, P50: 75.2, P75: 77.0, P90: 78.6, P97: 80.1},
            13: {P3: 71.4, P10: 73.0, P25: 74.6, P50: 76.4, P75: 78.2, P90: 79.8, P97: 81.4},
            14: {P3: 72.5, P10: 74.1, P25: 75.7, P50: 77.5, P75: 79.3, P90: 81.0, P97: 82.6},
            15: {P3: 73.5, P10: 75.2, P25: 76.8, P50: 78.6, P75: 80.5, P90: 82.1, P97: 83.8},
            16: {P3: 74.6, P10: 76.2, P25: 77.9, P50: 79.7, P75: 81.6, P90: 83.3, P97: 84.9},
            17: {P3: 75.5, P10: 77.2, P25: 78.9, P50: 80.8, P75: 82.7, P90: 84.4, P97: 86.1},
            18: {P3: 76.5, P10: 78.2, P25: 79.9, P50: 81.9, P75: 83.8, P90: 85.5, P97: 87.2},
            19: {P3: 77.5, P10: 79.2, P25: 80.9, P50: 82.9, P75: 84.8, P90: 86.6, P97: 88.3},
            20: {P3: 78.4, P10: 80.2, P25: 81.9, P50: 83.9, P75: 85.9, P90: 87.6, P97: 89.4},
            21: {P3: 79.3, P10: 81.1, P25: 82.9, P50: 84.9, P75: 86.9, P90: 88.7, P97: 90.4},
            22: {P3: 80.2, P10: 82.0, P25: 83.8, P50: 85.8, P75: 87.9, P90: 89.7, P97: 91.5},
            23: {P3: 81.1, P10: 82.9, P25: 84.7, P50: 86.8, P75: 88.8, P90: 90.7, P97: 92.5},
            24: {P3: 81.2, P10: 83.0, P25: 84.9, P50: 87.0, P75: 89.1, P90: 90.9, P97: 92.8},
            27: {P3: 83.6, P10: 85.5, P25: 87.4, P50: 89.5, P75: 91.7, P90: 93.6, P97: 95.5},
            30: {P3: 85.7, P10: 87.7, P25: 89.7, P50: 91.9, P75: 94.1, P90: 96.1, P97: 98.1},
            33: {P3: 87.7, P10: 89.8, P25: 91.8, P50: 94.1, P75: 96.4, P90: 98.4, P97: 100.5},
            36: {P3: 89.7, P10: 91.8, P25: 93.9, P50: 96.2, P75: 98.5, P90: 100.7, P97: 102.7},
            39: {P3: 91.5, P10: 93.6, P25: 95.8, P50: 98.1, P75: 100.4, P90: 102.6, P97: 104.7},
            42: {P3: 93.2, P10: 95.4, P25: 97.5, P50: 99.9, P75: 102.2, P90: 104.4, P97: 106.5},
            45: {P3: 94.8, P10: 97.0, P25: 99.2, P50: 101.6, P75: 103.9, P90: 106.1, P97: 108.2},
            48: {P3: 96.5, P10: 98.8, P25: 101.1, P50: 103.7, P75: 106.3, P90: 108.6, P97: 110.9},
            51: {P3: 98.0, P10: 100.3, P25: 102.7, P50: 105.3, P75: 107.9, P90: 110.2, P97: 112.5},
            54: {P3: 99.5, P10: 101.8, P25: 104.2, P50: 106.8, P75: 109.4, P90: 111.7, P97: 114.0},
            57: {P3: 100.9, P10: 103.3, P25: 105.7, P50: 108.3, P75: 110.9, P90: 113.2, P97: 115.5},
            60: {P3: 103.0, P10: 105.5, P25: 108.0, P50: 110.8, P75: 113.6, P90: 116.1, P97: 118.6},
            63: {P3: 104.4, P10: 106.9, P25: 109.4, P50: 112.2, P75: 115.0, P90: 117.5, P97: 120.0},
            66: {P3: 105.8, P10: 108.3, P25: 110.8, P50: 113.6, P75: 116.4, P90: 118.9, P97: 121.4},
            69: {P3: 107.1, P10: 109.6, P25: 112.1, P50: 114.9, P75: 117.7, P90: 120.2, P97: 122.7},
            72: {P3: 109.0, P10: 111.7, P25: 114.5, P50: 117.5, P75: 120.6, P90: 123.3, P97: 126.0},
            75: {P3: 110.3, P10: 113.0, P25: 115.8, P50: 118.8, P75: 121.9, P90: 124.6, P97: 127.3},
            78: {P3: 111.6, P10: 114.3, P25: 117.1, P50: 120.1, P75: 123.2, P90: 125.9, P97: 128.6},
            81: {P3: 112.9, P10: 115.6, P25: 118.4, P50: 121.4, P75: 124.5, P90: 127.2, P97: 129.9}
        };

        const ageBMIBoy = {
            0: {P3: 11.2, P10: 11.8, P25: 12.5, P50: 13.2, P75: 14.0, P90: 14.8, P97: 15.5},
            1: {P3: 13.0, P10: 13.6, P25: 14.3, P50: 15.1, P75: 16.0, P90: 16.8, P97: 17.6},
            3: {P3: 14.9, P10: 15.7, P25: 16.5, P50: 17.4, P75: 18.5, P90: 19.5, P97: 20.5},
            6: {P3: 15.3, P10: 16.1, P25: 16.9, P50: 17.9, P75: 18.9, P90: 20.0, P97: 21.1},
            12: {P3: 14.9, P10: 15.5, P25: 16.3, P50: 17.1, P75: 18.1, P90: 19.1, P97: 20.1},
            24: {P3: 14.1, P10: 14.7, P25: 15.3, P50: 16.1, P75: 17.0, P90: 17.9, P97: 18.8},
            36: {P3: 13.7, P10: 14.2, P25: 14.8, P50: 15.5, P75: 16.3, P90: 17.2, P97: 18.1},
            48: {P3: 13.4, P10: 14.0, P25: 14.6, P50: 15.3, P75: 16.1, P90: 17.0, P97: 17.9},
            60: {P3: 13.3, P10: 13.8, P25: 14.5, P50: 15.3, P75: 16.2, P90: 17.1, P97: 18.2},
            72: {P3: 13.2, P10: 13.8, P25: 14.5, P50: 15.4, P75: 16.4, P90: 17.5, P97: 18.8}
        };

        const ageBMIGirl = {
            0: {P3: 11.1, P10: 11.7, P25: 12.3, P50: 13.1, P75: 13.8, P90: 14.5, P97: 15.3},
            1: {P3: 12.7, P10: 13.3, P25: 13.9, P50: 14.7, P75: 15.5, P90: 16.3, P97: 17.1},
            3: {P3: 14.4, P10: 15.1, P25: 15.8, P50: 16.7, P75: 17.7, P90: 18.7, P97: 19.8},
            6: {P3: 14.9, P10: 15.6, P25: 16.4, P50: 17.3, P75: 18.4, P90: 19.4, P97: 20.5},
            12: {P3: 14.5, P10: 15.1, P25: 15.8, P50: 16.7, P75: 17.6, P90: 18.5, P97: 19.6},
            24: {P3: 13.8, P10: 14.4, P25: 15.0, P50: 15.8, P75: 16.6, P90: 17.4, P97: 18.4},
            36: {P3: 13.4, P10: 13.9, P25: 14.5, P50: 15.3, P75: 16.1, P90: 16.9, P97: 17.9},
            48: {P3: 13.1, P10: 13.7, P25: 14.3, P50: 15.1, P75: 15.9, P90: 16.8, P97: 17.8},
            60: {P3: 13.0, P10: 13.5, P25: 14.2, P50: 15.0, P75: 15.9, P90: 16.9, P97: 18.0},
            72: {P3: 12.9, P10: 13.5, P25: 14.1, P50: 15.0, P75: 16.0, P90: 17.1, P97: 18.3}
        };

        // 身高别体重数据表（0-2岁：身长别体重，2-7岁：身高别体重）
        const lengthWeightBoy0_2 = {
            45: {P3: 2.0, P10: 2.1, P25: 2.2, P50: 2.3, P75: 2.5, P90: 2.6, P97: 2.7},
            50: {P3: 2.8, P10: 2.9, P25: 3.1, P50: 3.3, P75: 3.5, P90: 3.7, P97: 3.9},
            55: {P3: 3.9, P10: 4.1, P25: 4.3, P50: 4.6, P75: 4.9, P90: 5.2, P97: 5.5},
            60: {P3: 5.2, P10: 5.4, P25: 5.7, P50: 6.1, P75: 6.5, P90: 6.8, P97: 7.2},
            65: {P3: 6.4, P10: 6.7, P25: 7.1, P50: 7.5, P75: 7.9, P90: 8.4, P97: 8.9},
            70: {P3: 7.5, P10: 7.8, P25: 8.2, P50: 8.7, P75: 9.2, P90: 9.7, P97: 10.3},
            75: {P3: 8.4, P10: 8.8, P25: 9.2, P50: 9.7, P75: 10.3, P90: 10.9, P97: 11.5},
            80: {P3: 9.3, P10: 9.7, P25: 10.1, P50: 10.7, P75: 11.3, P90: 11.9, P97: 12.6},
            85: {P3: 10.2, P10: 10.6, P25: 11.1, P50: 11.7, P75: 12.3, P90: 13.0, P97: 13.7},
            90: {P3: 11.2, P10: 11.6, P25: 12.1, P50: 12.8, P75: 13.5, P90: 14.2, P97: 14.9},
            95: {P3: 12.2, P10: 12.7, P25: 13.2, P50: 13.9, P75: 14.7, P90: 15.4, P97: 16.2},
            100: {P3: 13.3, P10: 13.9, P25: 14.5, P50: 15.2, P75: 16.0, P90: 16.8, P97: 17.7}
        };

        const lengthWeightGirl0_2 = {
            45: {P3: 2.0, P10: 2.1, P25: 2.2, P50: 2.3, P75: 2.5, P90: 2.6, P97: 2.8},
            50: {P3: 2.8, P10: 2.9, P25: 3.1, P50: 3.3, P75: 3.5, P90: 3.7, P97: 3.9},
            55: {P3: 3.9, P10: 4.1, P25: 4.3, P50: 4.6, P75: 4.9, P90: 5.1, P97: 5.4},
            60: {P3: 5.1, P10: 5.4, P25: 5.6, P50: 6.0, P75: 6.3, P90: 6.7, P97: 7.1},
            65: {P3: 6.2, P10: 6.5, P25: 6.9, P50: 7.3, P75: 7.7, P90: 8.1, P97: 8.6},
            70: {P3: 7.2, P10: 7.6, P25: 7.9, P50: 8.4, P75: 8.9, P90: 9.4, P97: 9.9},
            75: {P3: 8.1, P10: 8.5, P25: 8.9, P50: 9.4, P75: 9.9, P90: 10.5, P97: 11.1},
            80: {P3: 9.0, P10: 9.4, P25: 9.8, P50: 10.3, P75: 10.9, P90: 11.5, P97: 12.2},
            85: {P3: 9.9, P10: 10.3, P25: 10.8, P50: 11.3, P75: 12.0, P90: 12.6, P97: 13.3},
            90: {P3: 10.9, P10: 11.3, P25: 11.8, P50: 12.4, P75: 13.1, P90: 13.8, P97: 14.6},
            95: {P3: 11.9, P10: 12.4, P25: 12.9, P50: 13.6, P75: 14.4, P90: 15.1, P97: 16.0},
            100: {P3: 13.1, P10: 13.6, P25: 14.2, P50: 14.9, P75: 15.8, P90: 16.6, P97: 17.5}
        };

        const heightWeightBoy2_7 = {
            75: {P3: 8.5, P10: 8.9, P25: 9.4, P50: 9.9, P75: 10.5, P90: 11.0, P97: 11.7},
            80: {P3: 9.4, P10: 9.8, P25: 10.3, P50: 10.8, P75: 11.5, P90: 12.1, P97: 12.7},
            85: {P3: 10.3, P10: 10.8, P25: 11.2, P50: 11.8, P75: 12.5, P90: 13.2, P97: 13.9},
            90: {P3: 11.3, P10: 11.8, P25: 12.3, P50: 12.9, P75: 13.6, P90: 14.3, P97: 15.1},
            95: {P3: 12.3, P10: 12.8, P25: 13.4, P50: 14.1, P75: 14.8, P90: 15.6, P97: 16.4},
            100: {P3: 13.5, P10: 14.1, P25: 14.7, P50: 15.4, P75: 16.2, P90: 17.0, P97: 17.9},
            105: {P3: 14.8, P10: 15.4, P25: 16.0, P50: 16.8, P75: 17.7, P90: 18.7, P97: 19.7},
            110: {P3: 16.1, P10: 16.7, P25: 17.5, P50: 18.4, P75: 19.4, P90: 20.5, P97: 21.6},
            115: {P3: 17.0, P10: 17.8, P25: 18.8, P50: 19.9, P75: 21.1, P90: 22.4, P97: 23.8},
            120: {P3: 18.5, P10: 19.5, P25: 20.6, P50: 22.0, P75: 23.5, P90: 25.0, P97: 26.8},
            125: {P3: 20.2, P10: 21.4, P25: 22.7, P50: 24.3, P75: 26.2, P90: 28.1, P97: 30.2},
            130: {P3: 21.8, P10: 23.2, P25: 24.8, P50: 26.8, P75: 29.0, P90: 31.3, P97: 33.9}
        };

        const heightWeightGirl2_7 = {
            75: {P3: 8.3, P10: 8.6, P25: 9.0, P50: 9.5, P75: 10.1, P90: 10.6, P97: 11.2},
            80: {P3: 9.1, P10: 9.5, P25: 9.9, P50: 10.5, P75: 11.1, P90: 11.7, P97: 12.3},
            85: {P3: 10.0, P10: 10.5, P25: 10.9, P50: 11.5, P75: 12.1, P90: 12.8, P97: 13.5},
            90: {P3: 11.0, P10: 11.5, P25: 12.0, P50: 12.6, P75: 13.3, P90: 14.0, P97: 14.8},
            95: {P3: 12.1, P10: 12.6, P25: 13.1, P50: 13.8, P75: 14.6, P90: 15.3, P97: 16.2},
            100: {P3: 13.2, P10: 13.8, P25: 14.4, P50: 15.1, P75: 16.0, P90: 16.8, P97: 17.8},
            105: {P3: 14.4, P10: 15.0, P25: 15.7, P50: 16.5, P75: 17.5, P90: 18.4, P97: 19.5},
            110: {P3: 15.7, P10: 16.4, P25: 17.1, P50: 18.1, P75: 19.1, P90: 20.2, P97: 21.4},
            115: {P3: 17.0, P10: 17.8, P25: 18.8, P50: 19.9, P75: 21.1, P90: 22.4, P97: 23.8},
            120: {P3: 18.5, P10: 19.5, P25: 20.6, P50: 22.0, P75: 23.5, P90: 25.0, P97: 26.8},
            125: {P3: 20.2, P10: 21.4, P25: 22.7, P50: 24.3, P75: 26.2, P90: 28.1, P97: 30.2},
            130: {P3: 21.8, P10: 23.2, P25: 24.8, P50: 26.8, P75: 29.0, P90: 31.3, P97: 33.9}
        };

        // 年龄别头围数据表
        const ageHeadBoy = {
            0: {P3: 31.9, P10: 32.7, P25: 33.4, P50: 34.3, P75: 35.2, P90: 36.0, P97: 36.8},
            1: {P3: 34.8, P10: 35.5, P25: 36.2, P50: 37.0, P75: 37.8, P90: 38.5, P97: 39.2},
            3: {P3: 38.3, P10: 39.0, P25: 39.7, P50: 40.5, P75: 41.3, P90: 42.0, P97: 42.7},
            6: {P3: 41.1, P10: 41.8, P25: 42.5, P50: 43.4, P75: 44.2, P90: 44.9, P97: 45.7},
            12: {P3: 43.8, P10: 44.6, P25: 45.3, P50: 46.1, P75: 47.0, P90: 47.8, P97: 48.6},
            24: {P3: 46.0, P10: 46.7, P25: 47.5, P50: 48.3, P75: 49.2, P90: 50.0, P97: 50.8},
            36: {P3: 47.0, P10: 47.7, P25: 48.5, P50: 49.3, P75: 50.2, P90: 51.1, P97: 51.9}
        };

        const ageHeadGirl = {
            0: {P3: 31.5, P10: 32.3, P25: 33.1, P50: 33.9, P75: 34.8, P90: 35.6, P97: 36.3},
            1: {P3: 34.2, P10: 34.9, P25: 35.6, P50: 36.3, P75: 37.1, P90: 37.8, P97: 38.5},
            3: {P3: 37.5, P10: 38.1, P25: 38.8, P50: 39.5, P75: 40.3, P90: 41.0, P97: 41.6},
            6: {P3: 40.0, P10: 40.7, P25: 41.4, P50: 42.2, P75: 43.0, P90: 43.8, P97: 44.5},
            12: {P3: 42.8, P10: 43.5, P25: 44.3, P50: 45.1, P75: 45.9, P90: 46.7, P97: 47.5},
            24: {P3: 45.0, P10: 45.7, P25: 46.5, P50: 47.3, P75: 48.2, P90: 49.0, P97: 49.8},
            36: {P3: 46.1, P10: 46.8, P25: 47.6, P50: 48.5, P75: 49.4, P90: 50.3, P97: 51.1}
        };

        // ===================== 标准差数据表（表B.1-B.12，根据WS/T 423-2022标准）=====================
        // 注意：以下数据需要从PDF文档的表B.1-B.12中提取真实数据替换
        // 当前使用从百分位计算的估算值作为占位符，请用PDF中的真实mean和SD值替换

        // 表B.1: 7岁以下男童年龄别体重的标准差数值 (单位: kg) - mean: 平均值, SD: 标准差
        const ageWeightBoyStd = {
            // 格式: 年龄(月): {mean: 平均值, SD: 标准差}
            // 请从PDF表B.1中提取真实数据替换以下占位符
            0: {mean: 3.5, SD: 0.4},  // 从PDF表B.1提取：+1SD=3.9, SD=3.9-3.5=0.4
            1: {mean: 4.6, SD: 0.5},  // 从PDF表B.1提取：+1SD=5.1, SD=5.1-4.6=0.5
            2: {mean: 5.8, SD: 0.7},  // 从PDF表B.1提取：+1SD=6.5, SD=6.5-5.8=0.7
            3: {mean: 6.8, SD: 0.8},  // 从PDF表B.1提取：+1SD=7.6, SD=7.6-6.8=0.8
            4: {mean: 7.5, SD: 0.8},  // 从PDF表B.1提取：+1SD=8.3, SD=8.3-7.5=0.8
            5: {mean: 8.0, SD: 0.9},  // 从PDF表B.1提取：+1SD=8.9, SD=8.9-8.0=0.9
            6: {mean: 8.4, SD: 1.0},  // 从PDF表B.1提取：+1SD=9.4, SD=9.4-8.4=1.0
            7: {mean: 8.8, SD: 1.0},  // 从PDF表B.1提取：+1SD=9.8, SD=9.8-8.8=1.0
            8: {mean: 9.1, SD: 1.0},  // 从PDF表B.1提取：+1SD=10.1, SD=10.1-9.1=1.0
            9: {mean: 9.4, SD: 1.0},  // 从PDF表B.1提取：+1SD=10.4, SD=10.4-9.4=1.0
            10: {mean: 9.6, SD: 1.1}, // 从PDF表B.1提取：+1SD=10.7, SD=10.7-9.6=1.1
            11: {mean: 9.8, SD: 1.1}, // 从PDF表B.1提取：+1SD=10.9, SD=10.9-9.8=1.1
            12: {mean: 10.1, SD: 1.1}, // 从PDF表B.1提取：+1SD=11.2, SD=11.2-10.1=1.1
            13: {mean: 10.3, SD: 1.1}, // 从PDF表B.1提取：+1SD=11.4, SD=11.4-10.3=1.1
            14: {mean: 10.5, SD: 1.1}, // 从PDF表B.1提取：+1SD=11.6, SD=11.6-10.5=1.1
            15: {mean: 10.7, SD: 1.1}, // 从PDF表B.1提取：+1SD=11.8, SD=11.8-10.7=1.1
            16: {mean: 10.9, SD: 1.1}, // 从PDF表B.1提取：+1SD=12.0, SD=12.0-10.9=1.1
            17: {mean: 11.1, SD: 1.1}, // 从PDF表B.1提取：+1SD=12.2, SD=12.2-11.1=1.1
            18: {mean: 11.3, SD: 1.1}, // 从PDF表B.1提取：+1SD=12.4, SD=12.4-11.3=1.1
            19: {mean: 11.5, SD: 1.1}, // 从PDF表B.1提取：+1SD=12.6, SD=12.6-11.5=1.1
            20: {mean: 11.7, SD: 1.1}, // 从PDF表B.1提取：+1SD=12.8, SD=12.8-11.7=1.1
            21: {mean: 11.9, SD: 1.1}, // 从PDF表B.1提取：+1SD=13.0, SD=13.0-11.9=1.1
            22: {mean: 12.2, SD: 1.1}, // 从PDF表B.1提取：+1SD=13.3, SD=13.3-12.2=1.1
            23: {mean: 12.4, SD: 1.2}, // 从PDF表B.1提取：+1SD=13.6, SD=13.6-12.4=1.2
            24: {mean: 12.6, SD: 1.2}, // 从PDF表B.1提取：+1SD=13.8, SD=13.8-12.6=1.2
            27: {mean: 13.1, SD: 1.60}, // 占位符，需替换
            30: {mean: 13.7, SD: 1.67}, // 占位符，需替换
            33: {mean: 14.2, SD: 1.74}, // 占位符，需替换
            36: {mean: 14.6, SD: 1.81}, // 占位符，需替换
            39: {mean: 15.2, SD: 1.88}, // 占位符，需替换
            42: {mean: 15.7, SD: 1.95}, // 占位符，需替换
            45: {mean: 16.2, SD: 2.02}, // 占位符，需替换
            48: {mean: 16.7, SD: 1.1}, // 从PDF表B.1提取：+1SD=18.8, SD=18.8-16.7=1.1
            51: {mean: 17.3, SD: 2.16}, // 占位符，需替换
            54: {mean: 17.9, SD: 2.23}, // 占位符，需替换
            57: {mean: 18.4, SD: 2.30}, // 占位符，需替换
            60: {mean: 19.1, SD: 2.37}, // 占位符，需替换
            63: {mean: 19.7, SD: 2.44}, // 占位符，需替换
            66: {mean: 20.3, SD: 2.51}, // 占位符，需替换
            69: {mean: 21.0, SD: 2.58}, // 占位符，需替换
            72: {mean: 21.6, SD: 2.65}, // 占位符，需替换
            75: {mean: 22.2, SD: 2.72}, // 占位符，需替换
            78: {mean: 22.8, SD: 2.79}, // 占位符，需替换
            81: {mean: 23.4, SD: 2.86}  // 占位符，需替换
        };

        // 表B.2: 7岁以下女童年龄别体重的标准差数值 (单位: kg)
        const ageWeightGirlStd = {
            // 请从PDF表B.2中提取真实数据替换
            0: {mean: 3.3, SD: 0.35},  // 占位符，需替换
            1: {mean: 4.3, SD: 0.45},  // 占位符，需替换
            2: {mean: 5.4, SD: 0.55},  // 占位符，需替换
            3: {mean: 6.2, SD: 0.64},  // 占位符，需替换
            4: {mean: 6.9, SD: 0.72},  // 占位符，需替换
            5: {mean: 7.4, SD: 0.79},  // 占位符，需替换
            6: {mean: 7.8, SD: 0.85},  // 占位符，需替换
            7: {mean: 8.1, SD: 0.91},  // 占位符，需替换
            8: {mean: 8.4, SD: 0.97},  // 占位符，需替换
            9: {mean: 8.7, SD: 1.03},  // 占位符，需替换
            10: {mean: 9.0, SD: 1.09}, // 占位符，需替换
            11: {mean: 9.2, SD: 1.15}, // 占位符，需替换
            12: {mean: 9.4, SD: 1.21}, // 占位符，需替换
            13: {mean: 9.6, SD: 1.27}, // 占位符，需替换
            14: {mean: 9.8, SD: 1.33}, // 占位符，需替换
            15: {mean: 10.0, SD: 1.39}, // 占位符，需替换
            16: {mean: 10.3, SD: 1.45}, // 占位符，需替换
            17: {mean: 10.5, SD: 1.51}, // 占位符，需替换
            18: {mean: 10.7, SD: 1.57}, // 占位符，需替换
            19: {mean: 10.9, SD: 1.63}, // 占位符，需替换
            20: {mean: 11.1, SD: 1.69}, // 占位符，需替换
            21: {mean: 11.3, SD: 1.75}, // 占位符，需替换
            22: {mean: 11.5, SD: 1.81}, // 占位符，需替换
            23: {mean: 11.7, SD: 1.87}, // 占位符，需替换
            24: {mean: 11.9, SD: 1.93}, // 占位符，需替换
            27: {mean: 12.5, SD: 2.05}, // 占位符，需替换
            30: {mean: 13.0, SD: 2.17}, // 占位符，需替换
            33: {mean: 13.6, SD: 2.29}, // 占位符，需替换
            36: {mean: 14.1, SD: 2.41}, // 占位符，需替换
            39: {mean: 14.7, SD: 2.53}, // 占位符，需替换
            42: {mean: 15.2, SD: 2.65}, // 占位符，需替换
            45: {mean: 15.7, SD: 2.77}, // 占位符，需替换
            48: {mean: 16.2, SD: 2.89}, // 占位符，需替换
            51: {mean: 16.7, SD: 3.01}, // 占位符，需替换
            54: {mean: 17.2, SD: 3.13}, // 占位符，需替换
            57: {mean: 17.8, SD: 3.25}, // 占位符，需替换
            60: {mean: 18.4, SD: 3.37}, // 占位符，需替换
            63: {mean: 19.0, SD: 3.49}, // 占位符，需替换
            66: {mean: 19.6, SD: 3.61}, // 占位符，需替换
            69: {mean: 20.2, SD: 3.73}, // 占位符，需替换
            72: {mean: 20.7, SD: 3.85}, // 占位符，需替换
            75: {mean: 21.3, SD: 3.97}, // 占位符，需替换
            78: {mean: 21.8, SD: 4.09}, // 占位符，需替换
            81: {mean: 22.4, SD: 4.21}  // 占位符，需替换
        };

        // 表B.3: 7岁以下男童年龄别身长/身高的标准差数值 (单位: cm)
        const ageHeightBoyStd = {
            // 请从PDF表B.3中提取真实数据替换
            0: {mean: 51.2, SD: 1.9},  // 从PDF表B.3提取：+1SD=53.1, SD=53.1-51.2=1.9
            1: {mean: 55.1, SD: 2.1},  // 从PDF表B.3提取：+1SD=57.2, SD=57.2-55.1=2.1
            2: {mean: 59.0, SD: 2.1},  // 从PDF表B.3提取：+1SD=61.1, SD=61.1-59.0=2.1
            3: {mean: 62.2, SD: 2.2},  // 从PDF表B.3提取：+1SD=64.4, SD=64.4-62.2=2.2
            4: {mean: 64.8, SD: 2.3},  // 从PDF表B.3提取：+1SD=67.1, SD=67.1-64.8=2.3
            5: {mean: 66.9, SD: 2.4},  // 从PDF表B.3提取：+1SD=69.3, SD=69.3-66.9=2.4
            6: {mean: 68.7, SD: 2.4},  // 从PDF表B.3提取：+1SD=71.1, SD=71.1-68.7=2.4
            7: {mean: 70.3, SD: 2.4},  // 从PDF表B.3提取：+1SD=72.7, SD=72.7-70.3=2.4
            8: {mean: 71.7, SD: 2.5},  // 从PDF表B.3提取：+1SD=74.2, SD=74.2-71.7=2.5
            9: {mean: 73.1, SD: 2.5},  // 从PDF表B.3提取：+1SD=75.6, SD=75.6-73.1=2.5
            10: {mean: 74.3, SD: 2.6}, // 从PDF表B.3提取：+1SD=76.9, SD=76.9-74.3=2.6
            11: {mean: 75.5, SD: 2.6}, // 从PDF表B.3提取：+1SD=78.1, SD=78.1-75.5=2.6
            12: {mean: 76.7, SD: 2.6}, // 从PDF表B.3提取：+1SD=79.3, SD=79.3-76.7=2.6
            13: {mean: 77.6, SD: 3.73}, // 占位符，需替换
            14: {mean: 78.5, SD: 3.87}, // 占位符，需替换
            15: {mean: 79.3, SD: 4.01}, // 占位符，需替换
            16: {mean: 80.1, SD: 4.15}, // 占位符，需替换
            17: {mean: 81.0, SD: 4.29}, // 占位符，需替换
            18: {mean: 81.8, SD: 4.43}, // 占位符，需替换
            19: {mean: 82.6, SD: 4.57}, // 占位符，需替换
            20: {mean: 83.3, SD: 4.71}, // 占位符，需替换
            21: {mean: 84.0, SD: 4.85}, // 占位符，需替换
            22: {mean: 84.6, SD: 4.99}, // 占位符，需替换
            23: {mean: 85.2, SD: 5.13}, // 占位符，需替换
            24: {mean: 88.2, SD: 3.1}, // 从PDF表B.3提取：+1SD=91.3, SD=91.3-88.2=3.1
            27: {mean: 90.8, SD: 3.2}, // 从PDF表B.3提取：+1SD=94.0, SD=94.0-90.8=3.2
            30: {mean: 93.2, SD: 3.3}, // 从PDF表B.3提取：+1SD=96.5, SD=96.5-93.2=3.3
            33: {mean: 95.4, SD: 3.4}, // 从PDF表B.3提取：+1SD=98.8, SD=98.8-95.4=3.4
            36: {mean: 97.5, SD: 3.5}, // 从PDF表B.3提取：+1SD=101.0, SD=101.0-97.5=3.5
            39: {mean: 99.5, SD: 3.6}, // 从PDF表B.3提取：+1SD=103.1, SD=103.1-99.5=3.6
            42: {mean: 101.3, SD: 3.7}, // 从PDF表B.3提取：+1SD=105.0, SD=105.0-101.3=3.7
            45: {mean: 103.1, SD: 3.8}, // 从PDF表B.3提取：+1SD=106.9, SD=106.9-103.1=3.8
            48: {mean: 104.9, SD: 3.9}, // 从PDF表B.3提取：+1SD=108.8, SD=108.8-104.9=3.9
            51: {mean: 106.6, SD: 6.53}, // 占位符，需替换
            54: {mean: 108.4, SD: 6.67}, // 占位符，需替换
            57: {mean: 110.2, SD: 6.81}, // 占位符，需替换
            60: {mean: 112.0, SD: 6.95}, // 占位符，需替换
            63: {mean: 113.7, SD: 7.09}, // 占位符，需替换
            66: {mean: 115.5, SD: 7.23}, // 占位符，需替换
            69: {mean: 117.1, SD: 7.37}, // 占位符，需替换
            72: {mean: 118.8, SD: 7.51}, // 占位符，需替换
            75: {mean: 120.4, SD: 7.65}, // 占位符，需替换
            78: {mean: 122.0, SD: 7.79}, // 占位符，需替换
            81: {mean: 123.5, SD: 7.93}  // 占位符，需替换
        };

        // 表B.4: 7岁以下女童年龄别身长/身高的标准差数值 (单位: cm)
        const ageHeightGirlStd = {
            // 请从PDF表B.4中提取真实数据替换
            0: {mean: 50.3, SD: 1.78},  // 占位符，需替换
            1: {mean: 54.1, SD: 1.92},  // 占位符，需替换
            2: {mean: 57.7, SD: 2.06},  // 占位符，需替换
            3: {mean: 60.8, SD: 2.20},  // 占位符，需替换
            4: {mean: 63.3, SD: 2.34},  // 占位符，需替换
            5: {mean: 65.3, SD: 2.48},  // 占位符，需替换
            6: {mean: 67.1, SD: 2.62},  // 占位符，需替换
            7: {mean: 68.7, SD: 2.76},  // 占位符，需替换
            8: {mean: 70.1, SD: 2.90},  // 占位符，需替换
            9: {mean: 71.5, SD: 3.04},  // 占位符，需替换
            10: {mean: 72.8, SD: 3.18}, // 占位符，需替换
            11: {mean: 74.0, SD: 3.32}, // 占位符，需替换
            12: {mean: 75.2, SD: 3.46}, // 占位符，需替换
            13: {mean: 76.4, SD: 3.60}, // 占位符，需替换
            14: {mean: 77.5, SD: 3.74}, // 占位符，需替换
            15: {mean: 78.6, SD: 3.88}, // 占位符，需替换
            16: {mean: 79.7, SD: 4.02}, // 占位符，需替换
            17: {mean: 80.8, SD: 4.16}, // 占位符，需替换
            18: {mean: 81.9, SD: 4.30}, // 占位符，需替换
            19: {mean: 82.9, SD: 4.44}, // 占位符，需替换
            20: {mean: 83.9, SD: 4.58}, // 占位符，需替换
            21: {mean: 84.9, SD: 4.72}, // 占位符，需替换
            22: {mean: 85.8, SD: 4.86}, // 占位符，需替换
            23: {mean: 86.8, SD: 5.00}, // 占位符，需替换
            24: {mean: 87.0, SD: 5.14}, // 占位符，需替换
            27: {mean: 89.5, SD: 5.28}, // 占位符，需替换
            30: {mean: 91.9, SD: 5.42}, // 占位符，需替换
            33: {mean: 94.1, SD: 5.56}, // 占位符，需替换
            36: {mean: 96.2, SD: 5.70}, // 占位符，需替换
            39: {mean: 98.1, SD: 5.84}, // 占位符，需替换
            42: {mean: 99.9, SD: 5.98}, // 占位符，需替换
            45: {mean: 101.6, SD: 6.12}, // 占位符，需替换
            48: {mean: 103.7, SD: 6.26}, // 占位符，需替换
            51: {mean: 105.3, SD: 6.40}, // 占位符，需替换
            54: {mean: 106.8, SD: 6.54}, // 占位符，需替换
            57: {mean: 108.3, SD: 6.68}, // 占位符，需替换
            60: {mean: 110.8, SD: 6.82}, // 占位符，需替换
            63: {mean: 112.2, SD: 6.96}, // 占位符，需替换
            66: {mean: 113.6, SD: 7.10}, // 占位符，需替换
            69: {mean: 114.9, SD: 7.24}, // 占位符，需替换
            72: {mean: 117.5, SD: 7.38}, // 占位符，需替换
            75: {mean: 118.8, SD: 7.52}, // 占位符，需替换
            78: {mean: 120.1, SD: 7.66}, // 占位符，需替换
            81: {mean: 121.4, SD: 7.80}  // 占位符，需替换
        };

        // 表B.9: 7岁以下男童年龄别BMI的标准差数值 (单位: kg/m²)
        const ageBMIBoyStd = {
            // 请从PDF表B.9中提取真实数据替换
            0: {mean: 13.2, SD: 0.88},  // 占位符，需替换
            1: {mean: 15.1, SD: 1.01},  // 占位符，需替换
            3: {mean: 17.4, SD: 1.14},  // 占位符，需替换
            6: {mean: 17.9, SD: 1.27},  // 占位符，需替换
            12: {mean: 17.1, SD: 1.40}, // 占位符，需替换
            24: {mean: 16.1, SD: 1.53}, // 占位符，需替换
            36: {mean: 15.5, SD: 1.66}, // 占位符，需替换
            48: {mean: 15.3, SD: 1.79}, // 占位符，需替换
            60: {mean: 15.3, SD: 1.92}, // 占位符，需替换
            72: {mean: 15.4, SD: 2.05}  // 占位符，需替换
        };

        // 表B.10: 7岁以下女童年龄别BMI的标准差数值 (单位: kg/m²)
        const ageBMIGirlStd = {
            // 请从PDF表B.10中提取真实数据替换
            0: {mean: 13.1, SD: 0.87},  // 占位符，需替换
            1: {mean: 14.7, SD: 1.00},  // 占位符，需替换
            3: {mean: 16.7, SD: 1.13},  // 占位符，需替换
            6: {mean: 17.3, SD: 1.26},  // 占位符，需替换
            12: {mean: 16.7, SD: 1.39}, // 占位符，需替换
            24: {mean: 15.8, SD: 1.52}, // 占位符，需替换
            36: {mean: 15.3, SD: 1.65}, // 占位符，需替换
            48: {mean: 15.1, SD: 1.78}, // 占位符，需替换
            60: {mean: 15.0, SD: 1.91}, // 占位符，需替换
            72: {mean: 15.0, SD: 2.04}  // 占位符，需替换
        };

        // 表B.5: 0~2岁男童身长别体重的标准差数值 (单位: kg)
        const lengthWeightBoy0_2Std = {
            // 格式: 身长(cm): {mean: 平均值, SD: 标准差}
            // 请从PDF表B.5中提取真实数据替换以下占位符
            45: {mean: 2.3, SD: 0.19},  // 占位符，需替换
            50: {mean: 3.3, SD: 0.28},  // 占位符，需替换
            55: {mean: 4.6, SD: 0.42},  // 占位符，需替换
            60: {mean: 6.1, SD: 0.53},  // 占位符，需替换
            65: {mean: 7.5, SD: 0.66},  // 占位符，需替换
            70: {mean: 8.7, SD: 0.79},  // 占位符，需替换
            75: {mean: 9.7, SD: 0.92},  // 占位符，需替换
            80: {mean: 10.7, SD: 1.05}, // 占位符，需替换
            85: {mean: 11.7, SD: 1.18}, // 占位符，需替换
            90: {mean: 12.8, SD: 1.31}, // 占位符，需替换
            95: {mean: 13.9, SD: 1.44}, // 占位符，需替换
            100: {mean: 15.2, SD: 1.57} // 占位符，需替换
            // 注意：需要补充完整的身长数据（46-99cm）
        };

        // 表B.6: 0~2岁女童身长别体重的标准差数值 (单位: kg)
        const lengthWeightGirl0_2Std = {
            // 请从PDF表B.6中提取真实数据替换
            45: {mean: 2.3, SD: 0.20},  // 占位符，需替换
            50: {mean: 3.3, SD: 0.29},  // 占位符，需替换
            55: {mean: 4.6, SD: 0.43},  // 占位符，需替换
            60: {mean: 6.0, SD: 0.54},  // 占位符，需替换
            65: {mean: 7.3, SD: 0.67},  // 占位符，需替换
            70: {mean: 8.4, SD: 0.80},  // 占位符，需替换
            75: {mean: 9.4, SD: 0.93},  // 占位符，需替换
            80: {mean: 10.3, SD: 1.06}, // 占位符，需替换
            85: {mean: 11.3, SD: 1.19}, // 占位符，需替换
            90: {mean: 12.4, SD: 1.32}, // 占位符，需替换
            95: {mean: 13.6, SD: 1.45}, // 占位符，需替换
            100: {mean: 14.9, SD: 1.58} // 占位符，需替换
            // 注意：需要补充完整的身长数据（46-99cm）
        };

        // 表B.7: 2~7岁男童身高别体重的标准差数值 (单位: kg)
        const heightWeightBoy2_7Std = {
            // 格式: 身高(cm): {mean: 平均值, SD: 标准差}
            // 请从PDF表B.7中提取真实数据替换
            75: {mean: 9.9, SD: 0.85},  // 占位符，需替换
            80: {mean: 10.8, SD: 0.92}, // 占位符，需替换
            85: {mean: 11.8, SD: 0.99}, // 占位符，需替换
            90: {mean: 12.9, SD: 1.06}, // 占位符，需替换
            95: {mean: 14.1, SD: 1.13}, // 占位符，需替换
            100: {mean: 15.4, SD: 1.20}, // 占位符，需替换
            105: {mean: 16.8, SD: 1.27}, // 占位符，需替换
            110: {mean: 18.4, SD: 1.34}, // 占位符，需替换
            115: {mean: 19.9, SD: 1.41}, // 占位符，需替换
            120: {mean: 22.0, SD: 1.48}, // 占位符，需替换
            125: {mean: 24.3, SD: 1.55}, // 占位符，需替换
            130: {mean: 26.8, SD: 1.62}  // 占位符，需替换
            // 注意：需要补充完整的身高数据（76-129cm）
        };

        // 表B.8: 2~7岁女童身高别体重的标准差数值 (单位: kg)
        const heightWeightGirl2_7Std = {
            // 请从PDF表B.8中提取真实数据替换
            75: {mean: 9.5, SD: 0.83},  // 占位符，需替换
            80: {mean: 10.5, SD: 0.90}, // 占位符，需替换
            85: {mean: 11.5, SD: 0.97}, // 占位符，需替换
            90: {mean: 12.6, SD: 1.04}, // 占位符，需替换
            95: {mean: 13.8, SD: 1.11}, // 占位符，需替换
            100: {mean: 15.1, SD: 1.18}, // 占位符，需替换
            105: {mean: 16.5, SD: 1.25}, // 占位符，需替换
            110: {mean: 18.1, SD: 1.32}, // 占位符，需替换
            115: {mean: 19.9, SD: 1.39}, // 占位符，需替换
            120: {mean: 22.0, SD: 1.46}, // 占位符，需替换
            125: {mean: 24.3, SD: 1.53}, // 占位符，需替换
            130: {mean: 26.8, SD: 1.60}  // 占位符，需替换
            // 注意：需要补充完整的身高数据（76-129cm）
        };

        // 表B.11: 0~3岁男童年龄别头围的标准差数值 (单位: cm)
        const ageHeadBoyStd = {
            // 请从PDF表B.11中提取真实数据替换
            0: {mean: 34.3, SD: 1.30},  // 占位符，需替换
            1: {mean: 37.0, SD: 1.17},  // 占位符，需替换
            3: {mean: 40.5, SD: 1.17},  // 占位符，需替换
            6: {mean: 43.4, SD: 1.22},  // 占位符，需替换
            12: {mean: 46.1, SD: 1.28}, // 占位符，需替换
            24: {mean: 48.3, SD: 1.28}, // 占位符，需替换
            36: {mean: 49.3, SD: 1.30}  // 占位符，需替换
            // 注意：需要补充完整的年龄数据（2, 4-5, 7-11, 13-23, 25-35个月）
        };

        // 表B.12: 0~3岁女童年龄别头围的标准差数值 (单位: cm)
        const ageHeadGirlStd = {
            // 请从PDF表B.12中提取真实数据替换
            0: {mean: 33.9, SD: 1.28},  // 占位符，需替换
            1: {mean: 36.3, SD: 1.15},  // 占位符，需替换
            3: {mean: 39.5, SD: 1.15},  // 占位符，需替换
            6: {mean: 42.2, SD: 1.20},  // 占位符，需替换
            12: {mean: 45.1, SD: 1.26}, // 占位符，需替换
            24: {mean: 47.3, SD: 1.26}, // 占位符，需替换
            36: {mean: 48.5, SD: 1.28}  // 占位符，需替换
            // 注意：需要补充完整的年龄数据（2, 4-5, 7-11, 13-23, 25-35个月）
        };

        // 设置模式
        function setMode(mode) {
            currentMode = mode;
            const buttons = document.querySelectorAll('.mode-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // 添加行
        function addRow() {
            rowCount++;
            const tbody = document.getElementById('tableBody');
            const row = document.createElement('tr');
            row.id = `row-${rowCount}`;
            
            const today = new Date().toISOString().split('T')[0];
            
            row.innerHTML = `
                <td>${rowCount}</td>
                <td><input type="text" class="name-input" placeholder="姓名"></td>
                <td>
                    <select class="gender-input">
                        <option value="">请选择</option>
                        <option value="男">男</option>
                        <option value="女">女</option>
                    </select>
                </td>
                <td><input type="date" class="birth-date-input"></td>
                <td class="age-cell result-cell"></td>
                <td><input type="date" class="check-date-input" value="${today}"></td>
                <td><input type="number" class="weight-input" step="0.1" min="10" max="70" placeholder="10-70"></td>
                <td class="std-weight-cell result-cell"></td>
                <td class="weight-eval-value-cell result-cell"></td>
                <td class="weight-eval-result-cell result-cell"></td>
                <td><input type="number" class="height-input" step="0.1" min="60" max="160" placeholder="60-160"></td>
                <td class="std-height-cell result-cell"></td>
                <td class="height-eval-value-cell result-cell"></td>
                <td class="height-eval-result-cell result-cell"></td>
                <td class="bmi-cell result-cell"></td>
                <td class="bmi-eval-result-cell result-cell"></td>
                <td class="age-weight-cell result-cell"></td>
                <td class="age-weight-eval-result-cell result-cell"></td>
                <td class="age-height-cell result-cell"></td>
                <td class="age-height-eval-result-cell result-cell"></td>
                <td class="height-weight-cell result-cell"></td>
                <td class="height-weight-eval-result-cell result-cell"></td>
                <td class="age-bmi-cell result-cell"></td>
                <td class="age-bmi-eval-result-cell result-cell"></td>
                <td><input type="number" class="head-circ-input" step="0.1" placeholder="3岁以下"></td>
                <td class="age-head-cell result-cell"></td>
                <td class="age-head-eval-result-cell result-cell"></td>
                <td><button class="delete-btn" onclick="deleteRow(${rowCount})">删除</button></td>
            `;
            
            tbody.appendChild(row);
            updateStatus();
        }

        // 删除行
        function deleteRow(id) {
            const row = document.getElementById(`row-${id}`);
            if (row) {
                row.remove();
                updateRowNumbers();
                updateStatus();
            }
        }

        // 更新行号
        function updateRowNumbers() {
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach((row, index) => {
                row.querySelector('td:first-child').textContent = index + 1;
            });
        }

        // 更新状态栏
        function updateStatus() {
            const rowCount = document.querySelectorAll('#tableBody tr').length;
            document.getElementById('statusBar').textContent = `共 ${rowCount} 行数据`;
        }

        // 计算年龄（月）
        // 使用新方法：先计算年数和月数，再调整，最后转换为总月数
        function calculateAgeMonths(birthDate, checkDate) {
            if (!birthDate) return null;
            
            // 解析日期，避免时区问题导致日期减少一天
            function parseDate(dateStr) {
                if (!dateStr) return null;
                // 如果已经是Date对象，使用本地时间的年、月、日重新构造
                if (dateStr instanceof Date) {
                    return new Date(dateStr.getFullYear(), dateStr.getMonth(), dateStr.getDate());
                }
                // 如果是字符串格式 "YYYY-MM-DD" 或 "YYYY/MM/DD"
                if (typeof dateStr === 'string') {
                    const dateStrTrimmed = dateStr.trim();
                    // 尝试分割 "-" 或 "/"
                    const parts = dateStrTrimmed.split(/[-\/]/);
                    if (parts.length === 3) {
                        // 直接使用年、月、日构造Date对象，避免时区转换
                        return new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
                    }
                }
                // 尝试标准解析，然后使用本地时间重新构造
                const d = new Date(dateStr);
                if (!isNaN(d.getTime())) {
                    // 使用本地时间的年、月、日重新构造，避免时区问题
                    return new Date(d.getFullYear(), d.getMonth(), d.getDate());
                }
                return null;
            }
            
            const birth = parseDate(birthDate);
            if (!birth || isNaN(birth.getTime())) {
                return null;
            }
            
            const check = checkDate ? parseDate(checkDate) : new Date();
            if (!check || isNaN(check.getTime())) {
                return null;
            }
            
            // 确保check日期不早于birth日期
            if (check < birth) {
                return null;
            }
            
            // 步骤1：计算整年数
            let 整年数 = check.getFullYear() - birth.getFullYear();
            
            // 步骤2：计算整月数
            let 整月数 = check.getMonth() - birth.getMonth();
            
            // 步骤3：如果测查日 < 出生日，则整月数减1（因为不足一个月）
            if (check.getDate() < birth.getDate()) {
                整月数--;
            }
            
            // 步骤4：调整整年数和整月数，使整月数在0-11之间
            if (整月数 < 0) {
                整年数--; 
                整月数 += 12;
            }
            
            // 返回总月数
            const totalMonths = 整年数 * 12 + 整月数;
            
            // 允许超过84个月（7岁），但负数年龄无效
            if (totalMonths < 0) {
                return null;
            }
            
            return totalMonths;
        }

        // 格式化年龄（支持超过7岁）
        function formatAge(months) {
            if (months === null || months < 0) return '-';
            const years = Math.floor(months / 12);
            const monthsRemain = months % 12;
            return `${years}岁${monthsRemain}月`;
        }
        
        // 获取用于查表的年龄（如果超过84个月，使用84个月）
        function getAgeForLookup(ageMonths) {
            if (ageMonths === null || ageMonths < 0) return null;
            // 如果超过84个月（7岁），使用84个月来查表
            return ageMonths > 84 ? 84 : ageMonths;
        }
        
        // 格式化显示值（空值显示为"-"）
        function formatDisplayValue(value) {
            if (value === null || value === undefined || value === '' || value === 'null' || value === 'undefined') {
                return '-';
            }
            return String(value);
        }

        // 线性插值
        function linearInterpolate(key, k1, v1, k2, v2) {
            if (k1 === k2) return v1;
            return v1 + (v2 - v1) * (key - k1) / (k2 - k1);
        }

        // 查找最接近的键
        function findClosestKeys(keys, target) {
            keys = keys.sort((a, b) => a - b);
            if (target <= keys[0]) return [keys[0], keys[0]];
            if (target >= keys[keys.length - 1]) return [keys[keys.length - 1], keys[keys.length - 1]];
            for (let i = 0; i < keys.length - 1; i++) {
                if (target >= keys[i] && target <= keys[i + 1]) {
                    return [keys[i], keys[i + 1]];
                }
            }
            return [keys[0], keys[keys.length - 1]];
        }

        // 获取百分位数值
        function getPercentileValue(table, key, percentile) {
            if (!table || key === null) return null;
            const keys = Object.keys(table).map(k => parseInt(k));
            if (key in table) {
                return table[key][percentile];
            }
            const [k1, k2] = findClosestKeys(keys, key);
            const v1 = table[k1][percentile];
            const v2 = table[k2][percentile];
            return linearInterpolate(key, k1, v1, k2, v2);
        }

        // 计算百分位
        function calculatePercentile(value, table, key) {
            if (value === null || key === null) return null;
            const keys = Object.keys(table).map(k => parseInt(k));
            let tableEntry;
            if (key in table) {
                tableEntry = table[key];
            } else {
                const [k1, k2] = findClosestKeys(keys, key);
                const percentiles = ['P3', 'P10', 'P25', 'P50', 'P75', 'P90', 'P97'];
                tableEntry = {};
                percentiles.forEach(p => {
                    const v1 = table[k1][p];
                    const v2 = table[k2][p];
                    tableEntry[p] = linearInterpolate(key, k1, v1, k2, v2);
                });
            }
            const percentiles = ['P3', 'P10', 'P25', 'P50', 'P75', 'P90', 'P97'];
            if (value < tableEntry.P3) return '<P3';
            if (value > tableEntry.P97) return '>P97';
            for (let i = 0; i < percentiles.length - 1; i++) {
                const p1 = percentiles[i];
                const p2 = percentiles[i + 1];
                if (value >= tableEntry[p1] && value <= tableEntry[p2]) {
                    let pValue;
                    if (i === 0) pValue = 3 + (value - tableEntry[p1]) / (tableEntry[p2] - tableEntry[p1]) * 7;
                    else if (i === 1) pValue = 10 + (value - tableEntry[p1]) / (tableEntry[p2] - tableEntry[p1]) * 15;
                    else if (i === 2) pValue = 25 + (value - tableEntry[p1]) / (tableEntry[p2] - tableEntry[p1]) * 25;
                    else if (i === 3) pValue = 50 + (value - tableEntry[p1]) / (tableEntry[p2] - tableEntry[p1]) * 25;
                    else if (i === 4) pValue = 75 + (value - tableEntry[p1]) / (tableEntry[p2] - tableEntry[p1]) * 15;
                    else pValue = 90 + (value - tableEntry[p1]) / (tableEntry[p2] - tableEntry[p1]) * 7;
                    return 'P' + Math.round(pValue);
                }
            }
            return '未知';
        }

        // 从标准差数据表直接计算Z-score（优先使用）
        function calculateStdFromStdTable(value, stdTable, key) {
            if (value === null || key === null || !stdTable) return null;
            const keys = Object.keys(stdTable).map(k => parseInt(k));
            let mean, sd;
            
            if (key in stdTable) {
                mean = stdTable[key].mean;
                sd = stdTable[key].SD;
            } else {
                // 线性插值
                const [k1, k2] = findClosestKeys(keys, key);
                mean = linearInterpolate(key, k1, stdTable[k1].mean, k2, stdTable[k2].mean);
                sd = linearInterpolate(key, k1, stdTable[k1].SD, k2, stdTable[k2].SD);
            }
            
            if (mean === null || sd === null || sd === 0) return null;
            return Math.round(((value - mean) / sd) * 100) / 100;
        }

        // 计算标准差（从百分位数据计算，作为备用方法）
        function calculateStdScore(value, p50, p97, p3) {
            if (value === null || p50 === null) return null;
            let sd;
            if (p97 !== null && p3 !== null) {
                sd = (p97 - p3) / 3.76;
            } else if (p97 !== null) {
                sd = (p97 - p50) / 1.88;
            } else if (p3 !== null) {
                sd = (p50 - p3) / 1.88;
            } else {
                return null;
            }
            if (sd === 0) return null;
            return Math.round(((value - p50) / sd) * 100) / 100;
        }

        // 计算标准差数值（优先使用标准差数据表，如果没有则从百分位计算）
        function calculateStdForValue(value, table, key, stdTable = null) {
            if (value === null || key === null) return null;
            
            // 优先使用标准差数据表（如果提供）
            if (stdTable) {
                const stdFromTable = calculateStdFromStdTable(value, stdTable, key);
                if (stdFromTable !== null) {
                    return stdFromTable;
                }
            }
            
            // 如果没有标准差数据表或查找失败，则从百分位数据计算
            const keys = Object.keys(table).map(k => parseInt(k));
            let p50, p97, p3;
            if (key in table) {
                p50 = table[key].P50;
                p97 = table[key].P97;
                p3 = table[key].P3;
            } else {
                const [k1, k2] = findClosestKeys(keys, key);
                p50 = linearInterpolate(key, k1, table[k1].P50, k2, table[k2].P50);
                p97 = linearInterpolate(key, k1, table[k1].P97, k2, table[k2].P97);
                p3 = linearInterpolate(key, k1, table[k1].P3, k2, table[k2].P3);
            }
            return calculateStdScore(value, p50, p97, p3);
        }

        // 根据百分位计算评价
        function calculateEvaluationFromPercentile(percentileStr) {
            if (!percentileStr || percentileStr === '未知') return {value: null, result: null};
            if (percentileStr.startsWith('<')) return {value: '<P3', result: '下'};
            if (percentileStr.startsWith('>')) return {value: '≥P97', result: '上'};
            if (percentileStr.startsWith('P')) {
                const pValue = parseInt(percentileStr.substring(1));
                if (pValue >= 97) return {value: 'P' + pValue, result: '上'};
                if (pValue >= 75) return {value: 'P' + pValue, result: '中上'};
                if (pValue >= 25) return {value: 'P' + pValue, result: '中'};
                if (pValue >= 3) return {value: 'P' + pValue, result: '中下'};
                return {value: 'P' + pValue, result: '下'};
            }
            return {value: null, result: null};
        }

        // 根据标准差计算评价
        function calculateEvaluationFromStd(stdValue) {
            if (stdValue === null) return {value: null, result: null};
            if (stdValue >= 2) return {value: stdValue.toFixed(2) + 'SD', result: '上'};
            if (stdValue >= 1) return {value: stdValue.toFixed(2) + 'SD', result: '中上'};
            if (stdValue >= -1) return {value: stdValue.toFixed(2) + 'SD', result: '中'};
            if (stdValue >= -2) return {value: stdValue.toFixed(2) + 'SD', result: '中下'};
            return {value: stdValue.toFixed(2) + 'SD', result: '下'};
        }

        // 根据百分位计算营养状况评价（按照表3标准）
        function calculateNutritionFromPercentile(percentileStr, indicatorType) {
            if (!percentileStr || percentileStr === '未知') return null;
            let stdApprox;
            if (percentileStr.startsWith('<')) stdApprox = -2.5;
            else if (percentileStr.startsWith('>')) stdApprox = 2.5;
            else if (percentileStr.startsWith('P')) {
                const pValue = parseInt(percentileStr.substring(1));
                if (pValue >= 97) stdApprox = 1.88 + (pValue - 97) / 3 * 1.12;
                else if (pValue >= 90) stdApprox = 1.28 + (pValue - 90) / 7 * 0.60;
                else if (pValue >= 75) stdApprox = 0.67 + (pValue - 75) / 15 * 0.61;
                else if (pValue >= 50) stdApprox = 0 + (pValue - 50) / 25 * 0.67;
                else if (pValue >= 25) stdApprox = -0.67 + (pValue - 25) / 25 * 0.61;
                else if (pValue >= 10) stdApprox = -1.28 + (pValue - 10) / 15 * 0.60;
                else if (pValue >= 3) stdApprox = -1.88 + (pValue - 3) / 7 * 0.60;
                else stdApprox = -2.5;
            } else return null;
            
            // 根据表3标准判断营养状况
            if (indicatorType === '年龄别体重') {
                if (stdApprox < -3) return '重度低体重';
                if (stdApprox < -2) return '低体重';
                return ''; // 正常范围，不显示评价
            } else if (indicatorType === '年龄别身高') {
                if (stdApprox < -3) return '重度生长迟缓';
                if (stdApprox < -2) return '生长迟缓';
                return ''; // 正常范围，不显示评价
            } else if (indicatorType === '身高别体重' || indicatorType === '年龄别BMI') {
                if (stdApprox >= 3) return '重度肥胖';
                if (stdApprox >= 2) return '肥胖';
                if (stdApprox >= 1) return '超重';
                if (stdApprox < -3) return '重度消瘦';
                if (stdApprox < -2) return '消瘦';
                return ''; // 正常范围（-2 SD ≤ • < +1 SD），不显示评价
            }
            return null;
        }

        // 根据标准差计算营养状况评价（按照表3标准）
        function calculateNutritionFromStd(stdValue, indicatorType) {
            if (stdValue === null) return null;
            
            // 根据表3标准判断营养状况
            if (indicatorType === '年龄别体重') {
                if (stdValue < -3) return '重度低体重';
                if (stdValue < -2) return '低体重';
                return ''; // 正常范围，不显示评价
            } else if (indicatorType === '年龄别身高') {
                if (stdValue < -3) return '重度生长迟缓';
                if (stdValue < -2) return '生长迟缓';
                return ''; // 正常范围，不显示评价
            } else if (indicatorType === '身高别体重' || indicatorType === '年龄别BMI') {
                if (stdValue >= 3) return '重度肥胖';
                if (stdValue >= 2) return '肥胖';
                if (stdValue >= 1) return '超重';
                if (stdValue < -3) return '重度消瘦';
                if (stdValue < -2) return '消瘦';
                return ''; // 正常范围（-2 SD ≤ • < +1 SD），不显示评价
            }
            return null;
        }

        // 计算单行
        function calculateRow(row) {
            const gender = row.querySelector('.gender-input').value;
            const birthDate = row.querySelector('.birth-date-input').value;
            const checkDate = row.querySelector('.check-date-input').value;
            const weight = parseFloat(row.querySelector('.weight-input').value) || null;
            const height = parseFloat(row.querySelector('.height-input').value) || null;
            const headCirc = parseFloat(row.querySelector('.head-circ-input').value) || null;

            if (!gender || !birthDate) {
                return; // 跳过没有必需数据的行
            }

            const ageMonths = calculateAgeMonths(birthDate, checkDate);
            if (ageMonths === null || ageMonths < 0) {
                return;
            }

            // 更新年龄（显示实际年龄，即使超过7岁）
            row.querySelector('.age-cell').textContent = formatAge(ageMonths);
            
            // 获取用于查表的年龄（如果超过84个月，使用84个月）
            const lookupAgeMonths = getAgeForLookup(ageMonths);
            
            // 如果没有体重或身高数据，初始化相关单元格为"-"
            if (!weight) {
                row.querySelector('.age-weight-cell').textContent = '-';
                row.querySelector('.weight-eval-value-cell').textContent = '-';
                row.querySelector('.weight-eval-result-cell').textContent = '-';
                const nutritionCell = row.querySelector('.age-weight-eval-result-cell');
                if (nutritionCell) nutritionCell.textContent = '-';
            }
            if (!height) {
                row.querySelector('.age-height-cell').textContent = '-';
                row.querySelector('.height-eval-value-cell').textContent = '-';
                row.querySelector('.height-eval-result-cell').textContent = '-';
                const nutritionCell = row.querySelector('.age-height-eval-result-cell');
                if (nutritionCell) nutritionCell.textContent = '-';
            }
            if (!weight || !height) {
                row.querySelector('.height-weight-cell').textContent = '-';
                const nutritionCell = row.querySelector('.height-weight-eval-result-cell');
                if (nutritionCell) nutritionCell.textContent = '-';
            }

            // 获取数据表
            const weightTable = gender === '男' ? ageWeightBoy : ageWeightGirl;
            const heightTable = gender === '男' ? ageHeightBoy : ageHeightGirl;
            const bmiTable = gender === '男' ? ageBMIBoy : ageBMIGirl;

            // 标准体重和身高（使用查表年龄，如果超过7岁则使用84个月）
            const stdWeight = getPercentileValue(weightTable, lookupAgeMonths, 'P50');
            const stdHeight = getPercentileValue(heightTable, lookupAgeMonths, 'P50');
            row.querySelector('.std-weight-cell').textContent = stdWeight ? stdWeight.toFixed(1) : '-';
            row.querySelector('.std-height-cell').textContent = stdHeight ? stdHeight.toFixed(1) : '-';

            // BMI
            let bmi = null;
            if (weight && height) {
                bmi = Math.round((weight / Math.pow(height / 100, 2)) * 10) / 10;
                row.querySelector('.bmi-cell').textContent = bmi.toFixed(1);
            } else {
                row.querySelector('.bmi-cell').textContent = '-';
            }

            // 体重计算（使用查表年龄）
            if (weight) {
                if (currentMode === 'percentile') {
                    const percentile = calculatePercentile(weight, weightTable, lookupAgeMonths);
                    if (percentile) {
                        row.querySelector('.age-weight-cell').textContent = percentile;
                        const eval = calculateEvaluationFromPercentile(percentile);
                        row.querySelector('.weight-eval-value-cell').textContent = eval.value || '-';
                        // 正常区间（空字符串）显示为 "-"
                        row.querySelector('.weight-eval-result-cell').textContent = (eval.result === '' || !eval.result) ? '-' : eval.result;
                        // 年龄别体重的评价结果列显示营养状况评价（表3标准）
                        const nutrition = calculateNutritionFromPercentile(percentile, '年龄别体重');
                        const nutritionCell = row.querySelector('.age-weight-eval-result-cell');
                        if (nutritionCell) {
                            // 正常区间（空字符串）显示为 "-"
                            nutritionCell.textContent = (nutrition === '' || nutrition === null) ? '-' : nutrition;
                        }
                    } else {
                        row.querySelector('.age-weight-cell').textContent = '-';
                        row.querySelector('.weight-eval-value-cell').textContent = '-';
                        row.querySelector('.weight-eval-result-cell').textContent = '-';
                        const nutritionCell = row.querySelector('.age-weight-eval-result-cell');
                        if (nutritionCell) nutritionCell.textContent = '-';
                    }
                } else {
                    // 优先使用标准差数据表（表B.1或B.2）
                    const weightStdTable = gender === '男' ? ageWeightBoyStd : ageWeightGirlStd;
                    const std = calculateStdForValue(weight, weightTable, lookupAgeMonths, weightStdTable);
                    if (std !== null) {
                        row.querySelector('.age-weight-cell').textContent = std.toFixed(2) + 'SD';
                        const eval = calculateEvaluationFromStd(std);
                        row.querySelector('.weight-eval-value-cell').textContent = eval.value || '-';
                        // 正常区间（空字符串）显示为 "-"
                        row.querySelector('.weight-eval-result-cell').textContent = (eval.result === '' || !eval.result) ? '-' : eval.result;
                        // 年龄别体重的评价结果列显示营养状况评价（表3标准）
                        const nutrition = calculateNutritionFromStd(std, '年龄别体重');
                        const nutritionCell = row.querySelector('.age-weight-eval-result-cell');
                        if (nutritionCell) {
                            // 正常区间（空字符串）显示为 "-"
                            nutritionCell.textContent = (nutrition === '' || nutrition === null) ? '-' : nutrition;
                        }
                    } else {
                        row.querySelector('.age-weight-cell').textContent = '-';
                        row.querySelector('.weight-eval-value-cell').textContent = '-';
                        row.querySelector('.weight-eval-result-cell').textContent = '-';
                        const nutritionCell = row.querySelector('.age-weight-eval-result-cell');
                        if (nutritionCell) nutritionCell.textContent = '-';
                    }
                }
            }

            // 身高计算（使用查表年龄）
            if (height) {
                if (currentMode === 'percentile') {
                    const percentile = calculatePercentile(height, heightTable, lookupAgeMonths);
                    if (percentile) {
                        row.querySelector('.age-height-cell').textContent = percentile;
                        const eval = calculateEvaluationFromPercentile(percentile);
                        row.querySelector('.height-eval-value-cell').textContent = eval.value || '-';
                        // 正常区间（空字符串）显示为 "-"
                        row.querySelector('.height-eval-result-cell').textContent = (eval.result === '' || !eval.result) ? '-' : eval.result;
                        // 年龄别身高的评价结果列显示营养状况评价（表3标准）
                        const nutrition = calculateNutritionFromPercentile(percentile, '年龄别身高');
                        const nutritionCell = row.querySelector('.age-height-eval-result-cell');
                        if (nutritionCell) {
                            // 正常区间（空字符串）显示为 "-"
                            nutritionCell.textContent = (nutrition === '' || nutrition === null) ? '-' : nutrition;
                        }
                    } else {
                        row.querySelector('.age-height-cell').textContent = '-';
                        row.querySelector('.height-eval-value-cell').textContent = '-';
                        row.querySelector('.height-eval-result-cell').textContent = '-';
                        const nutritionCell = row.querySelector('.age-height-eval-result-cell');
                        if (nutritionCell) nutritionCell.textContent = '-';
                    }
                } else {
                    // 优先使用标准差数据表（表B.3或B.4）
                    const heightStdTable = gender === '男' ? ageHeightBoyStd : ageHeightGirlStd;
                    const std = calculateStdForValue(height, heightTable, lookupAgeMonths, heightStdTable);
                    if (std !== null) {
                        row.querySelector('.age-height-cell').textContent = std.toFixed(2) + 'SD';
                        const eval = calculateEvaluationFromStd(std);
                        row.querySelector('.height-eval-value-cell').textContent = eval.value || '-';
                        // 正常区间（空字符串）显示为 "-"
                        row.querySelector('.height-eval-result-cell').textContent = (eval.result === '' || !eval.result) ? '-' : eval.result;
                        // 年龄别身高的评价结果列显示营养状况评价（表3标准）
                        const nutrition = calculateNutritionFromStd(std, '年龄别身高');
                        const nutritionCell = row.querySelector('.age-height-eval-result-cell');
                        if (nutritionCell) {
                            // 正常区间（空字符串）显示为 "-"
                            nutritionCell.textContent = (nutrition === '' || nutrition === null) ? '-' : nutrition;
                        }
                    } else {
                        row.querySelector('.age-height-cell').textContent = '-';
                        row.querySelector('.height-eval-value-cell').textContent = '-';
                        row.querySelector('.height-eval-result-cell').textContent = '-';
                        const nutritionCell = row.querySelector('.age-height-eval-result-cell');
                        if (nutritionCell) nutritionCell.textContent = '-';
                    }
                }
            }

            // BMI计算（使用查表年龄）
            if (bmi) {
                if (currentMode === 'percentile') {
                    const percentile = calculatePercentile(bmi, bmiTable, lookupAgeMonths);
                    if (percentile) {
                        row.querySelector('.age-bmi-cell').textContent = percentile;
                        const eval = calculateEvaluationFromPercentile(percentile);
                        // 正常区间（空字符串）显示为 "-"
                        row.querySelector('.bmi-eval-result-cell').textContent = (eval.result === '' || !eval.result) ? '-' : eval.result;
                        const nutrition = calculateNutritionFromPercentile(percentile, '年龄别BMI');
                        // 确保评价结果正确显示
                        const nutritionCell = row.querySelector('.age-bmi-eval-result-cell');
                        if (nutritionCell) {
                            // 正常区间（空字符串）显示为 "-"
                            nutritionCell.textContent = (nutrition === '' || nutrition === null) ? '-' : nutrition;
                        }
                    } else {
                        row.querySelector('.age-bmi-cell').textContent = '-';
                        row.querySelector('.bmi-eval-result-cell').textContent = '-';
                        const nutritionCell = row.querySelector('.age-bmi-eval-result-cell');
                        if (nutritionCell) nutritionCell.textContent = '-';
                    }
                } else {
                    // 优先使用标准差数据表（表B.9或B.10）
                    const bmiStdTable = gender === '男' ? ageBMIBoyStd : ageBMIGirlStd;
                    const std = calculateStdForValue(bmi, bmiTable, lookupAgeMonths, bmiStdTable);
                    if (std !== null) {
                        row.querySelector('.age-bmi-cell').textContent = std.toFixed(2) + 'SD';
                        const eval = calculateEvaluationFromStd(std);
                        // 正常区间（空字符串）显示为 "-"
                        row.querySelector('.bmi-eval-result-cell').textContent = (eval.result === '' || !eval.result) ? '-' : eval.result;
                        const nutrition = calculateNutritionFromStd(std, '年龄别BMI');
                        // 确保评价结果正确显示
                        const nutritionCell = row.querySelector('.age-bmi-eval-result-cell');
                        if (nutritionCell) {
                            // 正常区间（空字符串）显示为 "-"
                            nutritionCell.textContent = (nutrition === '' || nutrition === null) ? '-' : nutrition;
                        }
                    } else {
                        row.querySelector('.age-bmi-cell').textContent = '-';
                        row.querySelector('.bmi-eval-result-cell').textContent = '-';
                        const nutritionCell = row.querySelector('.age-bmi-eval-result-cell');
                        if (nutritionCell) nutritionCell.textContent = '-';
                    }
                }
            }

            // 身高别体重计算（使用查表年龄判断使用哪个表）
            if (weight && height) {
                let heightWeightTable;
                // 如果超过7岁，使用2-7岁的表（84个月对应2-7岁表）
                const ageForTable = lookupAgeMonths < 24 ? lookupAgeMonths : Math.min(lookupAgeMonths, 84);
                if (ageForTable < 24) {
                    heightWeightTable = gender === '男' ? lengthWeightBoy0_2 : lengthWeightGirl0_2;
                } else {
                    heightWeightTable = gender === '男' ? heightWeightBoy2_7 : heightWeightGirl2_7;
                }
                const heightRounded = Math.round(height);
                if (currentMode === 'percentile') {
                    const percentile = calculatePercentile(weight, heightWeightTable, heightRounded);
                    if (percentile) {
                        row.querySelector('.height-weight-cell').textContent = percentile;
                        const nutrition = calculateNutritionFromPercentile(percentile, '身高别体重');
                        // 确保评价结果正确显示
                        const nutritionCell = row.querySelector('.height-weight-eval-result-cell');
                        if (nutritionCell) {
                            // 正常区间（空字符串）显示为 "-"
                            nutritionCell.textContent = (nutrition === '' || nutrition === null) ? '-' : nutrition;
                        }
                    } else {
                        row.querySelector('.height-weight-cell').textContent = '-';
                        const nutritionCell = row.querySelector('.height-weight-eval-result-cell');
                        if (nutritionCell) nutritionCell.textContent = '-';
                    }
                } else {
                    // 优先使用标准差数据表（表B.5-B.8）
                    let heightWeightStdTable = null;
                    if (ageForTable < 24) {
                        heightWeightStdTable = gender === '男' ? lengthWeightBoy0_2Std : lengthWeightGirl0_2Std;
                    } else {
                        heightWeightStdTable = gender === '男' ? heightWeightBoy2_7Std : heightWeightGirl2_7Std;
                    }
                    const std = calculateStdForValue(weight, heightWeightTable, heightRounded, heightWeightStdTable);
                    if (std !== null) {
                        row.querySelector('.height-weight-cell').textContent = std.toFixed(2) + 'SD';
                        const nutrition = calculateNutritionFromStd(std, '身高别体重');
                        // 确保评价结果正确显示
                        const nutritionCell = row.querySelector('.height-weight-eval-result-cell');
                        if (nutritionCell) {
                            // 正常区间（空字符串）显示为 "-"
                            nutritionCell.textContent = (nutrition === '' || nutrition === null) ? '-' : nutrition;
                        }
                    } else {
                        row.querySelector('.height-weight-cell').textContent = '-';
                        const nutritionCell = row.querySelector('.height-weight-eval-result-cell');
                        if (nutritionCell) nutritionCell.textContent = '-';
                    }
                }
            }

            // 年龄别头围计算（仅3岁以下，使用查表年龄）
            if (headCirc && lookupAgeMonths <= 36) {
                const headTable = gender === '男' ? ageHeadBoy : ageHeadGirl;
                if (currentMode === 'percentile') {
                    const percentile = calculatePercentile(headCirc, headTable, lookupAgeMonths);
                    if (percentile) {
                        row.querySelector('.age-head-cell').textContent = percentile;
                        const eval = calculateEvaluationFromPercentile(percentile);
                        // 正常区间（空字符串）显示为 "-"
                        row.querySelector('.age-head-eval-result-cell').textContent = (eval.result === '' || !eval.result) ? '-' : eval.result;
                    } else {
                        // 计算失败时显示 "-"
                        row.querySelector('.age-head-cell').textContent = '-';
                        row.querySelector('.age-head-eval-result-cell').textContent = '-';
                    }
                } else {
                    // 优先使用标准差数据表（表B.11或B.12）
                    const headStdTable = gender === '男' ? ageHeadBoyStd : ageHeadGirlStd;
                    const std = calculateStdForValue(headCirc, headTable, lookupAgeMonths, headStdTable);
                    if (std !== null) {
                        row.querySelector('.age-head-cell').textContent = std.toFixed(2) + 'SD';
                        const eval = calculateEvaluationFromStd(std);
                        // 正常区间（空字符串）显示为 "-"
                        row.querySelector('.age-head-eval-result-cell').textContent = (eval.result === '' || !eval.result) ? '-' : eval.result;
                    } else {
                        // 计算失败时显示 "-"
                        row.querySelector('.age-head-cell').textContent = '-';
                        row.querySelector('.age-head-eval-result-cell').textContent = '-';
                    }
                }
            } else {
                // 如果没有输入头围数据，相关单元格应该为空（不是 "-"）
                row.querySelector('.age-head-cell').textContent = '';
                row.querySelector('.age-head-eval-result-cell').textContent = '';
            }
        }

        // 批量计算
        function calculateAll() {
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach(row => calculateRow(row));
            alert(`已计算 ${rows.length} 行数据！`);
        }

        // 清空所有
        function clearAll() {
            if (confirm('确定要清空所有数据吗？')) {
                document.getElementById('tableBody').innerHTML = '';
                rowCount = 0;
                updateStatus();
            }
        }

        // 导入Excel
        function importExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    // 读取第一个工作表
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // 转换为JSON格式
                    // 注意：SheetJS读取Excel日期时的行为：
                    // - 如果Excel单元格是日期格式，SheetJS会将其转换为Date对象或序列号
                    // - 如果Excel单元格是文本格式，SheetJS会保留原始字符串
                    // 我们使用raw: false让SheetJS自动转换日期，然后我们处理Date对象
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {
                        header: 1, 
                        defval: '',
                        raw: false  // false表示将日期转换为Date对象，这样我们可以统一处理
                    });
                    
                    if (jsonData.length < 2) {
                        alert('Excel文件数据不足，至少需要表头和数据行！');
                        return;
                    }

                    // 查找表头行（可能不在第一行）
                    let headerRowIndex = 0;
                    let headers = [];
                    let colMap = {};
                    
                    // 尝试从第一行开始查找，如果第一行没有找到"性别"和"出生日期"，继续查找
                    for (let rowIdx = 0; rowIdx < Math.min(5, jsonData.length); rowIdx++) {
                        headers = jsonData[rowIdx].map(h => String(h || '').trim());
                        colMap = {};
                        
                        // 匹配列名（支持多种可能的列名，不区分大小写）
                        headers.forEach((header, index) => {
                            if (!header) return;
                            const h = header.toLowerCase();
                            // 移除所有空格和特殊字符进行匹配
                            const hClean = h.replace(/\s+/g, '');
                            
                            if (hClean.includes('姓名') || h.includes('name')) colMap.name = index;
                            else if (hClean.includes('性别') || h.includes('gender') || h.includes('sex')) colMap.gender = index;
                            else if (hClean.includes('出生日期') || hClean.includes('出生') || h.includes('birth') || h.includes('birthdate')) {
                                colMap.birthDate = index;
                                console.log('找到出生日期列:', { index: index, header: header });
                            }
                            else if (hClean.includes('测查日期') || hClean.includes('检查日期') || hClean.includes('测量日期') || h.includes('check') || (h.includes('date') && !h.includes('birth'))) {
                                colMap.checkDate = index;
                                console.log('找到测查日期列:', { index: index, header: header });
                            }
                            else if (hClean.includes('体重') && !hClean.includes('标准') && !hClean.includes('增值')) colMap.weight = index;
                            else if (hClean.includes('身高') && !hClean.includes('标准') && !hClean.includes('增值')) colMap.height = index;
                            else if (hClean.includes('头围') && !hClean.includes('标准')) colMap.headCirc = index;
                        });

                        // 如果找到了必需的列，使用这一行作为表头
                        if (colMap.gender !== undefined && colMap.birthDate !== undefined) {
                            headerRowIndex = rowIdx;
                            console.log('找到表头行:', {
                                rowIndex: rowIdx,
                                headers: headers,
                                colMap: colMap
                            });
                            break;
                        }
                    }

                    // 如果仍然没有找到必需的列，显示错误信息
                    if (colMap.gender === undefined || colMap.birthDate === undefined) {
                        const foundHeaders = headers.filter(h => h).join('、');
                        alert(`Excel文件必须包含"性别"和"出生日期"列！\n\n检测到的列名：${foundHeaders || '未找到任何列名'}\n\n请确保Excel文件的第一行包含表头，且包含"性别"和"出生日期"列。`);
                        return;
                    }

                    // 清空现有数据
                    if (confirm('导入数据将覆盖现有数据，是否继续？')) {
                        document.getElementById('tableBody').innerHTML = '';
                        rowCount = 0;

                        // 从表头行的下一行开始读取数据
                        let importedCount = 0;
                        for (let i = headerRowIndex + 1; i < jsonData.length; i++) {
                            const row = jsonData[i];
                            if (!row || row.length === 0) continue;

                            // 检查是否有必需数据
                            const gender = row[colMap.gender] ? String(row[colMap.gender]).trim() : '';
                            // 处理日期：可能是Date对象、字符串或数字（Excel日期序列号）
                            let birthDate = row[colMap.birthDate];
                            let birthDateStr = '';
                            
                            // 详细的调试信息（可以在控制台查看）
                            if (i <= headerRowIndex + 3) {  // 检查前3行数据
                                console.log(`调试：第${i}行数据`, {
                                    rowIndex: i,
                                    birthDate: birthDate,
                                    birthDateType: typeof birthDate,
                                    isDate: birthDate instanceof Date,
                                    colIndex: colMap.birthDate,
                                    rowLength: row.length,
                                    rowData: row
                                });
                            }
                            
                            // 处理日期：检查所有可能的情况
                            if (birthDate !== undefined && birthDate !== null && birthDate !== '') {
                                // 调试：记录原始值
                                if (i <= headerRowIndex + 3) {
                                    console.log(`处理出生日期 - 第${i}行`, {
                                        rawValue: birthDate,
                                        type: typeof birthDate,
                                        isDate: birthDate instanceof Date,
                                        stringValue: String(birthDate)
                                    });
                                }
                                // 检查是否是Date对象
                                if (birthDate instanceof Date) {
                                    // 关键修复：使用本地时间方法，因为Excel日期是本地日期，不包含时区信息
                                    // 如果使用UTC方法，在UTC+8时区会导致日期减少一天
                                    const year = birthDate.getFullYear();
                                    const month = String(birthDate.getMonth() + 1).padStart(2, '0');
                                    const day = String(birthDate.getDate()).padStart(2, '0');
                                    birthDateStr = `${year}-${month}-${day}`;
                                    
                                    // 调试信息
                                    if (i === headerRowIndex + 1) {
                                        console.log('Date对象转换（使用本地时间）', {
                                            original: birthDate,
                                            localDate: birthDateStr,
                                            utcDate: `${birthDate.getUTCFullYear()}-${String(birthDate.getUTCMonth() + 1).padStart(2, '0')}-${String(birthDate.getUTCDate()).padStart(2, '0')}`,
                                            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                                        });
                                    }
                                } else {
                                    // 转换为字符串
                                    let dateStr = String(birthDate).trim();
                                    
                                    // 调试信息
                                    if (i <= headerRowIndex + 3) {
                                        console.log('处理字符串日期', {
                                            original: birthDate,
                                            stringValue: dateStr,
                                            length: dateStr.length
                                        });
                                    }
                                    
                                    // 先判断 8 位 YYYYMMDD（如 20221111），避免被误判为 Excel 序列号
                                    const dateNum = parseFloat(dateStr);
                                    if (dateStr.length === 8 && /^\d{8}$/.test(dateStr)) {
                                        const y = parseInt(dateStr.substring(0, 4), 10);
                                        if (y >= 1900 && y <= 2100) {
                                            birthDateStr = `${dateStr.substring(0, 4)}-${dateStr.substring(4, 6)}-${dateStr.substring(6, 8)}`;
                                        }
                                    }
                                    if (!birthDateStr && !isNaN(dateNum) && !isNaN(parseInt(dateStr)) && dateStr.trim() === String(dateNum) && dateNum > 25569) {
                                        // Excel日期序列号转换（5位左右的数字，如 44927）
                                        // Excel日期从1900-01-01开始（序列号1）
                                        // 基准日期：1899-12-30（UTC）
                                        const excelEpoch = Date.UTC(1899, 11, 30);
                                        // 计算日期：序列号1对应1900-01-01，所以需要减1
                                        const date = new Date(excelEpoch + (dateNum - 1) * 86400000);
                                        // 使用本地时间方法，因为Excel日期是本地日期
                                        const year = date.getFullYear();
                                        const month = String(date.getMonth() + 1).padStart(2, '0');
                                        const day = String(date.getDate()).padStart(2, '0');
                                        birthDateStr = `${year}-${month}-${day}`;
                                        if (i === headerRowIndex + 1) {
                                            console.log('Excel日期序列号转换', {
                                                excelNum: dateNum,
                                                converted: birthDateStr,
                                                dateObject: date.toISOString()
                                            });
                                        }
                                    }
                                    if (!birthDateStr && dateStr.includes('/')) {
                                        // 处理日期格式：可能是 YYYY/MM/DD 或 MM/DD/YY
                                        // 清理末尾的斜杠（如 "2021/04/02/" -> "2021/04/02"）
                                        let cleanDateStr = dateStr;
                                        if (cleanDateStr.endsWith('/')) {
                                            cleanDateStr = cleanDateStr.slice(0, -1);
                                        }
                                        const parts = cleanDateStr.split('/').filter(p => p && p.trim()); // 过滤空字符串
                                        
                                        if (parts.length >= 3) {
                                            let year, month, day;
                                            
                                            // 判断日期格式：MM/DD/YY 还是 YYYY/MM/DD
                                            const firstPart = parseInt(parts[0]);
                                            const secondPart = parseInt(parts[1]);
                                            const thirdPart = parseInt(parts[2]);
                                            
                                            // 如果第一部分 > 12，肯定是 YYYY/MM/DD 格式
                                            // 如果第一部分 <= 12 且第二部分 > 12，可能是 MM/DD/YY 格式
                                            if (firstPart > 12) {
                                                // YYYY/MM/DD 格式
                                                year = parts[0].trim();
                                                month = parts[1].trim().padStart(2, '0');
                                                day = parts[2].trim().padStart(2, '0');
                                            } else if (secondPart > 12) {
                                                // MM/DD/YY 格式（美式日期格式）
                                                month = parts[0].trim().padStart(2, '0');
                                                day = parts[1].trim().padStart(2, '0');
                                                // 处理年份：YY -> YYYY
                                                let yearPart = parseInt(parts[2].trim());
                                                if (yearPart < 50) {
                                                    year = '20' + parts[2].trim().padStart(2, '0'); // 00-49 -> 2000-2049
                                                } else {
                                                    year = '19' + parts[2].trim().padStart(2, '0'); // 50-99 -> 1950-1999
                                                }
                                            } else {
                                                // 无法确定，尝试两种格式
                                                // 先尝试 YYYY/MM/DD
                                                if (firstPart >= 1900 && firstPart <= 2100) {
                                                    year = parts[0].trim();
                                                    month = parts[1].trim().padStart(2, '0');
                                                    day = parts[2].trim().padStart(2, '0');
                                                } else {
                                                    // 尝试 MM/DD/YY
                                                    month = parts[0].trim().padStart(2, '0');
                                                    day = parts[1].trim().padStart(2, '0');
                                                    let yearPart = parseInt(parts[2].trim());
                                                    if (yearPart < 50) {
                                                        year = '20' + parts[2].trim().padStart(2, '0');
                                                    } else {
                                                        year = '19' + parts[2].trim().padStart(2, '0');
                                                    }
                                                }
                                            }
                                            
                                            birthDateStr = `${year}-${month}-${day}`;
                                            
                                            // 调试信息
                                            if (i <= headerRowIndex + 3) {
                                                console.log('字符串日期转换（/格式）', {
                                                    original: dateStr,
                                                    cleaned: cleanDateStr,
                                                    parts: parts,
                                                    detectedFormat: firstPart > 12 ? 'YYYY/MM/DD' : 'MM/DD/YY',
                                                    converted: birthDateStr
                                                });
                                            }
                                        } else {
                                            birthDateStr = dateStr;
                                            if (i <= headerRowIndex + 3) {
                                                console.warn('日期格式解析失败（/格式）', {
                                                    original: dateStr,
                                                    parts: parts,
                                                    partsLength: parts.length
                                                });
                                            }
                                        }
                                    }
                                    if (!birthDateStr && dateStr.includes('.')) {
                                        // 点号分隔：2021.11.9、2026. 2. 4（支持数字前后空格）
                                        const parts = dateStr.split('.').map(p => (p || '').trim()).filter(p => p);
                                        if (parts.length >= 3) {
                                            const firstPart = parseInt(parts[0], 10);
                                            const secondPart = parseInt(parts[1], 10);
                                            const thirdPart = parseInt(parts[2], 10);
                                            let year, month, day;
                                            if (firstPart > 12) {
                                                year = parts[0];
                                                month = parts[1].padStart(2, '0');
                                                day = parts[2].padStart(2, '0');
                                            } else if (secondPart > 12) {
                                                month = parts[0].padStart(2, '0');
                                                day = parts[1].padStart(2, '0');
                                                year = thirdPart < 50 ? '20' + parts[2].padStart(2, '0') : '19' + parts[2].padStart(2, '0');
                                            } else {
                                                if (firstPart >= 1900 && firstPart <= 2100) {
                                                    year = parts[0];
                                                    month = parts[1].padStart(2, '0');
                                                    day = parts[2].padStart(2, '0');
                                                } else {
                                                    month = parts[0].padStart(2, '0');
                                                    day = parts[1].padStart(2, '0');
                                                    year = thirdPart < 50 ? '20' + parts[2].padStart(2, '0') : '19' + parts[2].padStart(2, '0');
                                                }
                                            }
                                            birthDateStr = `${year}-${month}-${day}`;
                                        } else {
                                            birthDateStr = dateStr;
                                        }
                                    }
                                    if (!birthDateStr && dateStr.includes('-')) {
                                        // 已经是 YYYY-MM-DD 格式，直接使用
                                        birthDateStr = dateStr;
                                    }
                                    if (!birthDateStr && dateStr.length === 8 && !isNaN(dateStr)) {
                                        // 处理 20191101 格式（字符串形式的8位，上面已处理过纯8位数字）
                                        birthDateStr = `${dateStr.substring(0, 4)}-${dateStr.substring(4, 6)}-${dateStr.substring(6, 8)}`;
                                    }
                                    if (!birthDateStr) {
                                        // 其他格式，尝试直接使用
                                        birthDateStr = dateStr;
                                        if (i <= headerRowIndex + 3) {
                                            console.warn('使用原始字符串作为日期', {
                                                dateStr: dateStr,
                                                birthDateStr: birthDateStr
                                            });
                                        }
                                    }
                                }
                                
                                // 最终检查：确保birthDateStr有值
                                if (!birthDateStr && i <= headerRowIndex + 3) {
                                    console.error('❌ 日期处理失败，birthDateStr为空', {
                                        birthDate: birthDate,
                                        birthDateType: typeof birthDate,
                                        isDate: birthDate instanceof Date
                                    });
                                }
                            } else {
                                // 日期值为空
                                if (i <= headerRowIndex + 3) {
                                    console.warn('⚠️ 出生日期值为空', {
                                        birthDate: birthDate,
                                        colIndex: colMap.birthDate,
                                        rowIndex: i
                                    });
                                }
                            }
                            
                            // 检查必需数据，如果缺少则跳过并记录原因
                            if (!gender || !birthDateStr) {
                                if (i <= headerRowIndex + 3) {
                                    console.warn(`跳过第${i}行：`, {
                                        hasGender: !!gender,
                                        hasBirthDate: !!birthDateStr,
                                        gender: gender,
                                        birthDate: birthDate,
                                        birthDateStr: birthDateStr
                                    });
                                }
                                continue; // 跳过没有必需数据的行
                            }

                            // 添加新行
                            addRow();

                            // 获取最后添加的行
                            const rows = document.querySelectorAll('#tableBody tr');
                            const newRow = rows[rows.length - 1];

                            // 填充数据
                            if (colMap.name !== undefined) {
                                const nameValue = row[colMap.name] ? String(row[colMap.name]).trim() : '';
                                newRow.querySelector('.name-input').value = nameValue;
                            }
                            
                            if (gender) {
                                const genderSelect = newRow.querySelector('.gender-input');
                                if (gender === '男' || gender === 'M' || gender === 'male' || gender === '1') {
                                    genderSelect.value = '男';
                                } else if (gender === '女' || gender === 'F' || gender === 'female' || gender === '2') {
                                    genderSelect.value = '女';
                                }
                            }

                            // 设置出生日期（已经在上面处理好了格式）
                            if (birthDateStr) {
                                const birthDateInput = newRow.querySelector('.birth-date-input');
                                if (birthDateInput) {
                                    birthDateInput.value = birthDateStr;
                                    // 调试信息（前3行）
                                    if (i <= headerRowIndex + 3) {
                                        console.log(`✅ 成功设置出生日期 - 第${i}行`, {
                                            original: birthDate,
                                            converted: birthDateStr,
                                            inputValue: birthDateInput.value,
                                            inputFound: true
                                        });
                                    }
                                } else {
                                    console.error(`❌ 错误：找不到出生日期输入框 - 第${i}行`);
                                }
                            } else {
                                // 调试信息：为什么没有设置日期
                                if (i <= headerRowIndex + 3) {
                                    console.error(`❌ 警告：出生日期为空 - 第${i}行`, {
                                        birthDate: birthDate,
                                        birthDateType: typeof birthDate,
                                        colIndex: colMap.birthDate,
                                        rowData: row,
                                        birthDateStr: birthDateStr
                                    });
                                }
                            }

                            // 使用 !== undefined 判断，避免测查日期在第1列(index=0)时被误判为假而跳过
                            const hasCheckDateCol = colMap.checkDate !== undefined && colMap.checkDate !== null;
                            const checkDateRaw = hasCheckDateCol ? row[colMap.checkDate] : undefined;
                            const hasCheckDateValue = checkDateRaw !== undefined && checkDateRaw !== null && String(checkDateRaw).trim() !== '';
                            if (hasCheckDateCol && hasCheckDateValue) {
                                // 处理日期：可能是Date对象、字符串或数字
                                let checkDateValue = checkDateRaw;
                                let checkDateStr = '';
                                
                                if (checkDateValue instanceof Date) {
                                    // 使用本地时间，因为Excel日期是本地日期
                                    const year = checkDateValue.getFullYear();
                                    const month = String(checkDateValue.getMonth() + 1).padStart(2, '0');
                                    const day = String(checkDateValue.getDate()).padStart(2, '0');
                                    checkDateStr = `${year}-${month}-${day}`;
                                } else {
                                    // 转换为字符串
                                    let dateStr = String(checkDateValue).trim();
                                    
                                    // 清理末尾的斜杠
                                    if (dateStr.endsWith('/')) {
                                        dateStr = dateStr.slice(0, -1);
                                    }
                                    
                                    const dateNum = parseFloat(dateStr);
                                    const isPureNumber = !isNaN(dateNum) && !isNaN(parseInt(dateStr)) && dateStr.trim() === String(dateNum);
                                    // 先判断 8 位 YYYYMMDD（如 20251120），避免被误判为 Excel 序列号
                                    if (dateStr.length === 8 && /^\d{8}$/.test(dateStr)) {
                                        const y = parseInt(dateStr.substring(0, 4), 10);
                                        if (y >= 1900 && y <= 2100) {
                                            checkDateStr = `${dateStr.substring(0, 4)}-${dateStr.substring(4, 6)}-${dateStr.substring(6, 8)}`;
                                        }
                                    }
                                    if (!checkDateStr && isPureNumber && dateNum > 25569) {
                                        // Excel日期序列号转换
                                        const excelEpoch = Date.UTC(1899, 11, 30);
                                        const date = new Date(excelEpoch + (dateNum - 1) * 86400000);
                                        const year = date.getFullYear();
                                        const month = String(date.getMonth() + 1).padStart(2, '0');
                                        const day = String(date.getDate()).padStart(2, '0');
                                        checkDateStr = `${year}-${month}-${day}`;
                                    }
                                    if (!checkDateStr && dateStr.includes('/')) {
                                        // 与出生日期一致：支持 YYYY/M/D、YYYY/MM/DD、MM/DD/YY，并对每段 trim
                                        const parts = dateStr.split('/').map(p => (p || '').trim()).filter(p => p);
                                        if (parts.length >= 3) {
                                            const first = parseInt(parts[0], 10);
                                            const second = parseInt(parts[1], 10);
                                            const third = parseInt(parts[2], 10);
                                            let year, month, day;
                                            if (first > 12) {
                                                year = parts[0];
                                                month = parts[1].padStart(2, '0');
                                                day = parts[2].padStart(2, '0');
                                            } else if (second > 12) {
                                                month = parts[0].padStart(2, '0');
                                                day = parts[1].padStart(2, '0');
                                                const y = third;
                                                year = y < 50 ? '20' + parts[2].padStart(2, '0') : '19' + parts[2].padStart(2, '0');
                                            } else {
                                                if (first >= 1900 && first <= 2100) {
                                                    year = parts[0];
                                                    month = parts[1].padStart(2, '0');
                                                    day = parts[2].padStart(2, '0');
                                                } else {
                                                    month = parts[0].padStart(2, '0');
                                                    day = parts[1].padStart(2, '0');
                                                    const y = third;
                                                    year = y < 50 ? '20' + parts[2].padStart(2, '0') : '19' + parts[2].padStart(2, '0');
                                                }
                                            }
                                            checkDateStr = `${year}-${month}-${day}`;
                                        } else {
                                            checkDateStr = dateStr;
                                        }
                                    }
                                    if (!checkDateStr && dateStr.includes('.')) {
                                        // 点号分隔：2026.2.4、2026. 2. 4（支持数字前后空格）
                                        const parts = dateStr.split('.').map(p => (p || '').trim()).filter(p => p);
                                        if (parts.length >= 3) {
                                            const first = parseInt(parts[0], 10);
                                            const second = parseInt(parts[1], 10);
                                            const third = parseInt(parts[2], 10);
                                            let year, month, day;
                                            if (first > 12) {
                                                year = parts[0];
                                                month = parts[1].padStart(2, '0');
                                                day = parts[2].padStart(2, '0');
                                            } else if (second > 12) {
                                                month = parts[0].padStart(2, '0');
                                                day = parts[1].padStart(2, '0');
                                                year = third < 50 ? '20' + parts[2].padStart(2, '0') : '19' + parts[2].padStart(2, '0');
                                            } else {
                                                if (first >= 1900 && first <= 2100) {
                                                    year = parts[0];
                                                    month = parts[1].padStart(2, '0');
                                                    day = parts[2].padStart(2, '0');
                                                } else {
                                                    month = parts[0].padStart(2, '0');
                                                    day = parts[1].padStart(2, '0');
                                                    year = third < 50 ? '20' + parts[2].padStart(2, '0') : '19' + parts[2].padStart(2, '0');
                                                }
                                            }
                                            checkDateStr = `${year}-${month}-${day}`;
                                        } else {
                                            checkDateStr = dateStr;
                                        }
                                    }
                                    if (!checkDateStr && dateStr.includes('-')) {
                                        checkDateStr = dateStr;
                                    }
                                    if (!checkDateStr && dateStr.length === 8 && !isNaN(dateStr)) {
                                        checkDateStr = `${dateStr.substring(0, 4)}-${dateStr.substring(4, 6)}-${dateStr.substring(6, 8)}`;
                                    }
                                    if (!checkDateStr) {
                                        checkDateStr = dateStr;
                                    }
                                }
                                
                                if (checkDateStr) {
                                    const checkDateInput = newRow.querySelector('.check-date-input');
                                    if (checkDateInput) {
                                        checkDateInput.value = checkDateStr;
                                    }
                                }
                            }

                            if (colMap.weight !== undefined && row[colMap.weight] !== undefined && row[colMap.weight] !== '') {
                                let weightStr = String(row[colMap.weight]).trim();
                                // 处理以小数点结尾的情况（如"21."）
                                if (weightStr.endsWith('.')) {
                                    weightStr = weightStr.slice(0, -1);
                                }
                                const weight = parseFloat(weightStr);
                                if (!isNaN(weight) && weight > 0) {
                                    newRow.querySelector('.weight-input').value = weight;
                                }
                            }

                            if (colMap.height !== undefined && row[colMap.height] !== undefined && row[colMap.height] !== '') {
                                let heightStr = String(row[colMap.height]).trim();
                                // 处理以小数点结尾的情况
                                if (heightStr.endsWith('.')) {
                                    heightStr = heightStr.slice(0, -1);
                                }
                                const height = parseFloat(heightStr);
                                if (!isNaN(height) && height > 0) {
                                    newRow.querySelector('.height-input').value = height;
                                }
                            }

                            if (colMap.headCirc !== undefined && row[colMap.headCirc] !== undefined && row[colMap.headCirc] !== '') {
                                let headCircStr = String(row[colMap.headCirc]).trim();
                                // 处理以小数点结尾的情况
                                if (headCircStr.endsWith('.')) {
                                    headCircStr = headCircStr.slice(0, -1);
                                }
                                const headCirc = parseFloat(headCircStr);
                                if (!isNaN(headCirc) && headCirc > 0) {
                                    newRow.querySelector('.head-circ-input').value = headCirc;
                                }
                            }

                            importedCount++;
                        }

                        // 自动计算所有导入的数据
                        setTimeout(() => {
                            calculateAll();
                            alert(`成功导入 ${importedCount} 条数据并完成计算！`);
                        }, 100);

                        // 清空文件输入，以便可以再次选择同一文件
                        event.target.value = '';
                    }
                } catch (error) {
                    console.error('导入Excel错误:', error);
                    alert('导入Excel文件失败：' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // 导出Excel
        function exportExcel() {
            const rows = document.querySelectorAll('#tableBody tr');
            if (rows.length === 0) {
                alert('没有数据可导出！');
                return;
            }

            const wb = XLSX.utils.book_new();
            const wsData = [];

            // 表头
            wsData.push([
                '序号', '姓名', '性别', '出生日期', '实足年龄年月', '测查日期',
                '体重(kg)', '标准体重(kg)', '评价值', '评价结果',
                '身高(cm)', '标准身高(cm)', '评价值', '评价结果',
                'BMI', '评价结果',
                '儿童年龄别体重', '评价结果',
                '年龄别身高', '评价结果',
                '身高别体重', '评价结果',
                '年龄别BMI', '评价结果',
                '头围', '年龄别头围', '评价结果'
            ]);

            // 数据行
            rows.forEach(row => {
                // 辅助函数：将空值转换为"-"
                const getValue = (element, isInput = false) => {
                    if (!element) return '-';
                    const value = isInput ? element.value : element.textContent;
                    return (value && value.trim() !== '') ? value.trim() : '-';
                };
                
                const rowData = [
                    getValue(row.querySelector('td:first-child')),
                    getValue(row.querySelector('.name-input'), true),
                    getValue(row.querySelector('.gender-input'), true),
                    getValue(row.querySelector('.birth-date-input'), true),
                    getValue(row.querySelector('.age-cell')),
                    getValue(row.querySelector('.check-date-input'), true),
                    getValue(row.querySelector('.weight-input'), true),
                    getValue(row.querySelector('.std-weight-cell')),
                    getValue(row.querySelector('.weight-eval-value-cell')),
                    getValue(row.querySelector('.weight-eval-result-cell')),
                    getValue(row.querySelector('.height-input'), true),
                    getValue(row.querySelector('.std-height-cell')),
                    getValue(row.querySelector('.height-eval-value-cell')),
                    getValue(row.querySelector('.height-eval-result-cell')),
                    getValue(row.querySelector('.bmi-cell')),
                    getValue(row.querySelector('.bmi-eval-result-cell')),
                    getValue(row.querySelector('.age-weight-cell')),
                    getValue(row.querySelector('.age-weight-eval-result-cell')),
                    getValue(row.querySelector('.age-height-cell')),
                    getValue(row.querySelector('.age-height-eval-result-cell')),
                    getValue(row.querySelector('.height-weight-cell')),
                    getValue(row.querySelector('.height-weight-eval-result-cell')),
                    getValue(row.querySelector('.age-bmi-cell')),
                    getValue(row.querySelector('.age-bmi-eval-result-cell')),
                    getValue(row.querySelector('.head-circ-input'), true),
                    getValue(row.querySelector('.age-head-cell')),
                    getValue(row.querySelector('.age-head-eval-result-cell'))
                ];
                wsData.push(rowData);
            });

            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, '儿童生长标准');

            const modeText = currentMode === 'percentile' ? '百分位' : '标准差';
            const fileName = `儿童生长标准计算表_${modeText}_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            alert('导出成功！');
        }

        // 下载Excel模板
        function downloadTemplate() {
            const wb = XLSX.utils.book_new();
            const wsData = [];

            // 表头
            wsData.push([
                '姓名',
                '性别',
                '出生日期',
                '测查日期',
                '体重（kg)',
                '身高(cm)',
                '头围（3岁以下）'
            ]);

            // 添加一行示例数据（帮助用户理解格式）
            wsData.push([
                '示例',
                '男',
                '2020-01-01',
                '2024-01-01',
                '',
                '',
                ''
            ]);

            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // 设置列宽
            const colWidths = [
                { wch: 12 },  // 姓名
                { wch: 8 },   // 性别
                { wch: 12 },  // 出生日期
                { wch: 12 },  // 测查日期
                { wch: 12 },  // 体重（kg)
                { wch: 12 },  // 身高(cm)
                { wch: 15 }   // 头围（3岁以下）
            ];
            ws['!cols'] = colWidths;

            XLSX.utils.book_append_sheet(wb, ws, '数据模板');

            const fileName = '儿童生长标准数据模板.xlsx';
            XLSX.writeFile(wb, fileName);
            alert('模板下载成功！\n\n模板包含以下列：\n姓名、性别、出生日期、测查日期、体重（kg)、身高(cm)、头围（3岁以下）\n\n请填写数据后使用"导入Excel"功能导入。');
        }

        // 初始化：添加一行
        window.onload = function() {
            addRow();
        };
    </script>
</body>
</html>
